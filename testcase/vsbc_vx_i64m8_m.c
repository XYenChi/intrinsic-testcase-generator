/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    12718042878025380718, 930968294137273322, 6666041511596706937, 13050972140836971688, 15456745964887363262, 13847504314756351487, 16144333670776000780, 6634542222230924126, 7599524879797990314, 14776530765044960535, 4784827510169879443, 9093409262584628101, 2931687360545765211, 14536030902778859810, 11103341046386560763, 18441900794450150804
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    11218621952184420714, 7004927723344327904, 13309946502851368881, 5019393996340277226, 17153323091375621543, 13815502830444589631, 11252658256846795656, 13034341709231869171, 9438178030678350518, 14251702812435702261, 8579359449388740194, 6744061163390889520, 4069509553854377506, 605286939588900620, 6123859191653631029, 10037258192239924281
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m8(size_t avl);
    const int out_data[] = {
    11575710582578355803, 9413619743193341797, 11461046823940454361, 15789026564819683107, 3108621530232400189, 17621169353316470746, 15741634955030574492, 15243419911783244586, 15897367482357601699, 5803067319415443941, 2126706674333603605, 11561234851447510488, 3476387356816070744, 7332786200852408125, 16865980269656544812, 3421041115928925149
    };
    const int64_t *out = &out_data[0];
    bool8_t masked[] = {
    0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1
    };
    const bool8_t *mask = &masked[0];
    vint64m8_t data1_v = __riscv_vle64_v_i64m8_m (mask, *in1, vl);
    vint64m8_t data2_v = __riscv_vle64_v_i64m8_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vsbc_vx_i64m8_m (mask, data1_v, data2_v, vl);
        void vint8_t __riscv_vse64m8_v_i64 (vbool64_t mask, int64m8_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    1499420925840960004, -6073959429207054583, -6643904991254661945, 8031578144496694462, -1696577126488258282, 32001484311761855, 4891675413929205123, -6399799487000945045, -1838653150880360205, 524827952609258273, -3794531939218860751, 2349348099193738580, -1137822193308612296, 13930743963189959189, 4979481854732929734, 8404642602210226522
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
