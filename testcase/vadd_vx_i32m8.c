/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint32m8_t data1[] = {
    3806510955, 1925473439, 1857548068, 2662960706, 956849784, 1298905947, 1276352479, 2893694477, 1147133884, 3521658242, 4212937788, 1357348118, 2526219909, 1813070454, 2506178291, 2856441378, 1436611448, 4128170772, 1980252772, 1935541932, 2149795376, 218771815, 3663695174, 2230121208, 1229477786, 2908989290, 1452592064, 1232217148, 4129398789, 700390715, 1346761247, 3670717126
    };
    const vint32m8_t *in1 = &data1[0];
    vint32m8_t data2[] = {
    653550824, 3047357554, 1496010705, 444250351, 2021893275, 3866104616, 1378176019, 421431207, 716861187, 287470983, 4158802466, 3794925867, 1775255246, 2983232586, 1147831310, 2246042743, 2043070499, 2522342440, 1527919270, 1494411582, 2691870187, 1760109899, 3267802656, 3034340563, 2473813370, 1198385665, 730372763, 3436116316, 2760895583, 1961171258, 4124160987, 2656880952
    };
    const vint32m8_t *in2 = &data2[0];
    vint32m8_t out_data[64];
    vint32m8_t *out = &out_data[0];
    for (int n = 32, Q_element = 32;n >= 0; n -= Q_element) {
        vint32m8_t out = __riscv_vadd_vx_i32m8 (data1, data2, 64);
        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
      }
    vint32m8_t golden[] = {
    4460061779, 4972830993, 3353558773, 3107211057, 2978743059, 5165010563, 2654528498, 3315125684, 1863995071, 3809129225, 8371740254, 5152273985, 4301475155, 4796303040, 3654009601, 5102484121, 3479681947, 6650513212, 3508172042, 3429953514, 4841665563, 1978881714, 6931497830, 5264461771, 3703291156, 4107374955, 2182964827, 4668333464, 6890294372, 2661561973, 5470922234, 6327598078
    };
    int fail = 0;
    for (int i = 0; i < 32; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
