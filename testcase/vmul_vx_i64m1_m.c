/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    15557049927412199426, 5192437996910144982, 12416879361077704833, 9181579823366721737, 16621474680952151749, 11507695816490705226, 12789872695433546318, 14298804006118667913, 8307087802024140910, 12397232364106878512, 10057475429595548084, 5422451324639796961, 8544821380278424724, 15919039263869272426, 673480514906232573, 270709943916464001
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    7869281478970218142, 3214412343100921711, 8210415988195287067, 12281723981168649437, 17922729286991762166, 9968415036078060316, 13343808821952218118, 17418005620905368054, 11190225452974345433, 5327984775121035697, 8667205445705724102, 8933753118508592498, 3507877649718956290, 4721698732496252756, 5696664012325077192, 10128623370434888549
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m1(size_t avl);
    const int out_data[] = {
    5137083500420526995, 3196924761045882880, 4210975083786615172, 14888216367186774218, 11562104133028199765, 7788620923276033206, 13807880715419089249, 7641940326974109486, 11435112169171444454, 16548684241244923390, 3668354805225922596, 2518758725780454729, 4622191232468251031, 12412381138284951601, 15001263309665853980, 12066927370241639296
    };
    const int64_t *out = &out_data[0];
    bool64_t masked[] = {
    1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1
    };
    const bool64_t *mask = &masked[0];
    vint64m1_t data1_v = __riscv_vle64_v_i64m1_m (mask, *in1, vl);
    vint64m1_t data2_v = __riscv_vle64_v_i64m1_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmul_vx_i64m1_m (mask, data1_v, data2_v, vl);
        void vint64_t __riscv_vse64m1_v_i64 (vbool64_t mask, int64m1_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    122422804861199797489839130623227186492, 3196924761045882880, 4210975083786615172, 112765629101657278782648232062480712069, 11562104133028199765, 7788620923276033206, 13807880715419089249, 249056648550799152453094733521465051302, 92958185362303251790948671171406964030, 16548684241244923390, 87170205813442051317342499774778720568, 48442841431461834391702637684607798578, 29974187940719368564526249282611313960, 12412381138284951601, 3836592212268497807763695104129775016, 2741919064561415263002005776605624549
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
