/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    9915710552713319537, 283206456865470961, 7677911696988319467, 4405686938496482632, 10194411619918955365, 617896236490678015, 8555657011055528219, 13028637711448742957, 10311504435132447239, 16715366396244952275, 9583959909691460195, 14801696261588306279, 10625779628183463252, 16688747398140631511, 10392585883690565868, 12012405604318753547
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    15835706402311022130, 4258774496048250865, 397482649301316804, 7690478021529166398, 17631238513483836265, 8384936874571032810, 1771498028743022125, 6786390330486848859, 1418543935046912792, 17242980711635876104, 6277638493089814017, 4898502641257354965, 11893785989472126208, 3904262393966624814, 9138647195142735574, 17706404867939588196
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m4(size_t avl);
    const int out_data[] = {
    1928779182086006775, 5774840926407827085, 4936562309968769332, 15189826081600409816, 9388277749590832731, 11550572426693721791, 13487000514622005637, 15350840319064770828, 11991163917684237524, 14602394140724698246, 8195432311284822040, 5946078223266630424, 13693408671358796822, 11619965989231810860, 4096416036961782858, 10766636252189757810
    };
    const int64_t *out = &out_data[0];
    bool16_t masked[] = {
    1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1
    };
    const bool16_t *mask = &masked[0];
    vint64m4_t data1_v = __riscv_vle64_v_i64m4_m (mask, *in1, vl);
    vint64m4_t data2_v = __riscv_vle64_v_i64m4_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vsub_vx_u64m4_m (mask, data1_v, data2_v, vl);
        void vint16_t __riscv_vse64m4_v_i64 (vbool64_t mask, int64m4_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    -5919995849597702593, -3975568039182779904, 4936562309968769332, 15189826081600409816, 9388277749590832731, -7767040638080354795, 6784158982312506094, 15350840319064770828, 8892960500085534447, 14602394140724698246, 8195432311284822040, 9903193620330951314, -1268006361288662956, 12784485004174006697, 1253938688547830294, -5693999263620834649
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
