/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    16604417251063565753, 9427321499184679902, 16527098098987386378, 4928502133161067463, 4739602732176814884, 626851562343182080, 5992034930127082548, 15694828644273843411, 4854205286384614917, 12137309354102244286, 3833826787826909636, 960454216968230477, 3064174723755895828, 18160789708515351657, 6148025875698516343, 776303619327747382
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    7814992458067520357, 9598413734558141071, 13581525667232794267, 2579171053882083064, 10147324831192616576, 12230721451544436250, 2861481533120272249, 16291930990410182649, 4103977732272820737, 8742657404495663140, 2751679023868314762, 16973671606782637922, 17886101322165260679, 12232262499580740983, 335706721264280049, 437410231641087236
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m4(size_t avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m4_t data1_v = __riscv_vle64_v_i64m4 (*in1, vl);
    vint64m4_t data2_v = __riscv_vle64_v_i64m4 (*in2, vl);
    vint64m4_t out_v = __riscv_vle64_v_i64m4 (*out, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vsub_vx_u64m4 (data1_v, data2_v, vl);
        void vint64m4_t __riscv_vse64_v_i64 (int64m4_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    8789424792996045396, -171092235373461169, 2945572431754592111, 2349331079278984399, -5407722099015801692, -11603869889201254170, 3130553397006810299, -597102346136339238, 750227554111794180, 3394651949606581146, 1082147763958594874, -16013217389814407445, -14821926598409364851, 5928527208934610674, 5812319154434236294, 338893387686660146
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
