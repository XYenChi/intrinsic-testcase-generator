/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint64m8_t data1[] = {
    13262619352419783679, 6096677591345207652, 17314232866611391636, 8626594743832701743, 13077859865170563650, 12493093762248127532, 12220096333088241742, 15983084383110129008, 410423738420432575, 16507421966863729230, 7618028167812219335, 5349045804540402164, 14710748897412772580, 6623749479791063484, 4768914092951844511, 16464329576559037034
    };
    const vint64m8_t *in1 = &data1[0];
    vint64m8_t data2[] = {
    16533663466253300391, 14619503776972817562, 9805459567874848874, 17287172699940815307, 1472537670415345693, 3001092900095345819, 13390733713001469184, 3222594203309374077, 3405122041576043817, 16420641227810291568, 3882670096662611608, 17199914165582236515, 12175638972060210224, 14294073006973743171, 9462221647191130165, 18002562838808929899
    };
    const vint64m8_t *in2 = &data2[0];
    vint64m8_t out_data[64];
    vint64m8_t *out = &out_data[0];
    for (int n = 16, Q_element = 64;n >= 0; n -= Q_element) {
        vint64m8_t out = __riscv_vadd_vv_i64m8 (data1, data2, 64);
        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
      }
    vint64m8_t golden[] = {
    29796282818673084070, 20716181368318025214, 27119692434486240510, 25913767443773517050, 14550397535585909343, 15494186662343473351, 25610830046089710926, 19205678586419503085, 3815545779996476392, 32928063194674020798, 11500698264474830943, 22548959970122638679, 26886387869472982804, 20917822486764806655, 14231135740142974676, 34466892415367966933
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
