/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    5571283150093544619, -4636662087683764150, -3581582501605741487, 4392353425041761381, 8920833933743230909, 5330051353683247856, 1377697433729431446, 8687156294505815202, 8403232164190638784, 6137036268607466232, -2546449423820079257, 6525303168024135397, -1162580253466106368, -3043586419794357468, -1900026908266427871, 902239429427725229
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    -5366388100956019544, 688611237049889142, 1424517140547845060, 3586068292222407273, -3025982235874496362, -2274600125072123586, 3581965712851308162, 6173886382164493734, -12984254903961345, 4908395853184308741, -7423740404216306865, 8773407624468959553, 772470430957770527, -1407763762937197572, 1926010827031441791, -8976885562829569530
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m8(avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m8_t data1_v = __riscv_vle64_v_i64m8 (*in1, vl);
    vint64m8_t data2_v = __riscv_vle64_v_i64m8 (*in2, vl);
    vint64m8_t out_v = __riscv_vle64_v_i64m8 (*out, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vadd_vv_i64m8 (data1_v, data2_v, vl);
        void __riscv_vse64_v_i64m8 (int64_t *out, vint64m8_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    13022355683959644803, -5639622454262992775, -2324070199232430708, 525406794170481294, 2925311249947084379, 3877015856605254545, -1591718754100662501, 11059419570717540519, 12112090896918226353, -1205152934369193604, -7800205061005775554, 2743879165798557115, -3683707394617625193, -5393459275386517564, 1358478327454575385, 8451837179044886493
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
