/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const uint64_t data1[] = {
    2379201736413033496, 9079451077611191740, 17793148439691979439, 1453642999896561812, 10017800871520387646, 11898078726694054016, 12120529093633151772, 2347391661736309571, 17048076912498557998, 11298009947189625838, 12941811884895861449, 9119956000389228365, 1635126670572875565, 6966603283548708288, 18057860557071784786, 6806028972966439102
    };
    const uint64_t *in1 = &data1[0];
    const uint64_t data2[] = {
    7297213945117535811, 15066001614314463521, 15828277327309293788, 5040585308121560997, 4132742847913302312, 15719480858582904449, 12323800246705635964, 10040610414879249815, 7185016627211611094, 11446719573506529651, 16745358948914910122, 8221926186873301502, 3665013372653243536, 10018298382416447657, 2418000208668226184, 9500071993790071045
    };
    const uint64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m1(avl);
    const uint64_t out_data[16];
    const uint64_t *out = &out_data[0];
    vuint64m1_t data1_v = __riscv_vle64_v_u64m1 (in1, vl);
    vuint64m1_t data2_v = __riscv_vle64_v_u64m1 (in2, vl);
    vuint64m1_t out_v = __riscv_vle64_v_u64m1 (out, vl);
    for (size_t n = 0; n < vl; n++) {
		out = __riscv_vadd_vv_u64m1(op1, op2, vl);
        void __riscv_vse64_v_u64m1 (uint64_t *out, vuint64m1_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    uint64_t golden[] = {
    9676415681530569307, 5698708618216103645, 15174681693291721611, 6494228308018122809, 14150543719433689958, 9170815511567406849, 5997585266629236120, 12388002076615559386, 5786349466000617476, 4297985446986603873, 11240426760101219955, 17341882187262529867, 5300140043226119101, 16984901665965155945, 2029116692030459354, 16306100966756510147
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const uint64_t data1[] = {
    7623814881887290102, 10167540195965370578, 4462833788178101760, 8325117194639624256, 7223028755003318978, 9998396232906438994, 17585852511295757639, 3807270522932104794, 1716013446188423435, 12402720167141095647, 2047854826097675491, 4049690385669374144, 6586762933288559096, 13244082626941743538, 1116171452979751914, 2653177476878194950
    };
    const uint64_t *in1 = &data1[0];
    const uint64_t data2[] = {
    13147148834130145432, 9651575179798552663, 9260876324143599834, 12658641755977345184, 2123340982454301842, 17797242255732021769, 15637189063304393561, 3198079214980438955, 10418651803804701910, 13219452123508866491, 8447472109962961630, 15009506293620214281, 17205363935585151686, 5819465051356557912, 12090226442303725500, 15836707348686968144
    };
    const uint64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m1(avl);
    const uint64_t out_data[16];
    const uint64_t *out = &out_data[0];
    vuint64m1_t data1_v = __riscv_vle64_v_u64m1 (in1, vl);
    vuint64m1_t data2_v = __riscv_vle64_v_u64m1 (in2, vl);
    vuint64m1_t out_v = __riscv_vle64_v_u64m1 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_u64m1 (uint64_t *out, vuint64m1_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    uint64_t golden[] = {
    2324219642307883918, 1372371302054371625, 13723710112321701594, 2537014876907417824, 9346369737457620820, 9348894414928909147, 14776297500890599584, 7005349737912543749, 12134665249993125345, 7175428216940410522, 10495326936060637121, 612452605580036809, 5345382795164159166, 616803604588749834, 13206397895283477414, 43140751855611478
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
