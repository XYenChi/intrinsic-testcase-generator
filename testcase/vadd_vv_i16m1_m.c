/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint16m1_t data1[] = {
    29, 117, 95, 185, 105, 233, 16, 246, 197, 23, 118, 171, 212, 50, 218, 139, 50, 227, 112, 219, 181, 2, 37, 69, 73, 45, 17, 8, 84, 166, 123, 207, 55, 183, 151, 23, 133, 116, 211, 247, 62, 88, 15, 75, 74, 232, 247, 20, 235, 131, 125, 158, 151, 251, 25, 70, 133, 162, 145, 231, 247, 218, 159, 146
    };
    const vint16m1_t *in1 = &data1[0];
    vint16m1_t data2[] = {
    107, 59, 125, 109, 144, 155, 33, 231, 238, 160, 248, 223, 245, 244, 254, 22, 203, 24, 9, 154, 6, 152, 70, 119, 127, 68, 147, 245, 167, 144, 22, 62, 185, 124, 105, 251, 158, 164, 75, 252, 157, 218, 222, 35, 183, 171, 177, 9, 97, 123, 73, 218, 74, 152, 6, 247, 26, 29, 181, 23, 225, 58, 118, 248
    };
    const vint16m1_t *in2 = &data2[0];
    vint16m1_t out_data[] = {
    67, 163, 117, 64, 228, 250, 238, 20, 203, 57, 74, 127, 190, 212, 131, 156, 121, 63, 75, 141, 68, 253, 197, 174, 21, 160, 110, 135, 142, 242, 187, 225, 110, 253, 104, 108, 180, 63, 36, 147, 224, 246, 216, 29, 117, 244, 98, 130, 220, 56, 2, 22, 208, 156, 41, 150, 143, 126, 75, 147, 95, 143, 66, 102
    };
    vint16m1_t *out = &out_data[0];
    int masked[] = {
    1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1
    };
    const int *mask = &masked[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint16m1_t out = __riscv_vadd_vv_i16m1_m (, mask, data1, data264);
)        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
        mask += Q_element;
      }
    vint16m1_t golden[] = {
    136, 176, 220, 294, 249, 250, 238, 20, 203, 183, 74, 394, 457, 294, 472, 161, 253, 251, 121, 141, 187, 253, 107, 188, 200, 113, 164, 135, 251, 242, 187, 225, 110, 253, 256, 274, 291, 280, 36, 499, 219, 306, 216, 110, 257, 403, 98, 29, 220, 254, 2, 22, 225, 156, 31, 317, 143, 126, 75, 147, 95, 143, 277, 394
    };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
