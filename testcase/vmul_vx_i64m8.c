/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    4085830677095278819, 5085847449068375076, 8464042129346500071, 12728338403911318533, 5120182684375723709, 14580771453536924412, 10671974779012691981, 18149050000628804097, 5985448542811871872, 2619899084456145237, 4049861105434348981, 18071055041667318153, 5775761374283284430, 8156495786797017580, 17132948166605108257, 4347605444437594825
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    15749370709793168596, 11923584701537347615, 12220198717032434727, 3005426754294122835, 1293664857184978568, 11414863100666692, 6322091679566656516, 9031794138559799814, 7925555669328577598, 13948495957003471159, 5196084463374831655, 14222641059328099056, 1487979757436263911, 6941302051019028019, 6617141631544745391, 5154468641869684830
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m8(size_t avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m8_t data1_v = __riscv_vle64_v_i64m8 (*in1, vl);
    vint64m8_t data2_v = __riscv_vle64_v_i64m8 (*in2, vl);
    vint64m8_t out_v = __riscv_vle64_v_i64m8 (*out, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmul_vx_i64m8 (data1_v, data2_v, vl);
        void vint64m8_t __riscv_vse64_v_i64 (int64m8_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    64349261991018774015792104330094768124, 60641532838064421756134037595014043740, 103432276769948577111856461325208365617, 38254088776824429938692003977514001055, 6623800401143920807129211958654468712, 166437510044232886639929436410085104, 67469202954941347855585328056734598196, 163918483416107963971863687802543037958, 47438005631957104620780967393585523456, 36543651787293637468385408517644719683, 21043420368773441747364068725395793555, 257018129420995651081368931779050963568, 8594216008715783861460843997357205730, 56616700934022198805541650179655574020, 113371144584340880332656580007056793487, 22409595930575496908779166925989004750
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
