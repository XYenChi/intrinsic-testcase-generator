/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    int data1[] = {
    241, 160, 25, 249, 191, 85, 33, 69, 101, 20, 10, 26, 73, 126, 19, 232, 209, 143, 223, 232, 15, 240, 9, 79, 139, 188, 151, 255, 202, 77, 217, 98, 167, 178, 146, 59, 89, 70, 185, 58, 146, 195, 85, 81, 249, 159, 25, 156, 144, 109, 246, 89, 209, 248, 221, 51, 190, 150, 171, 238, 177, 251, 147, 89
    };
    const int *in1 = &data1[0];
    int data2[] = {
    74, 59, 149, 101, 192, 125, 158, 227, 133, 70, 160, 21, 20, 73, 12, 249, 124, 228, 234, 1, 74, 188, 247, 123, 114, 229, 151, 18, 161, 5, 2, 40, 7, 9, 70, 250, 177, 52, 73, 249, 126, 0, 83, 237, 32, 248, 39, 32, 123, 104, 30, 240, 92, 184, 105, 70, 52, 219, 74, 123, 88, 183, 91, 158
    };
    const int *in2 = &data2[0];
    int out_data[64];
    int *out = &out_data[0];
    int masked[] = {
    0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0
    };
    const int *mask = &masked[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint64m1_t out = __riscv_vsub_vx_i64m1_m (mask, data1, data2, 64);
        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
        mask += Q_element;
      }
   int golden[] = {
   167, 101, -124, 148, -1, -40, -125, -158, -32, -50, -150, 5, 53, 53, 7, -17, 85, -85, -11, 231, -59, 52, -238, -44, 25, -41, 0, 237, 41, 72, 215, 58, 160, 169, 76, -191, -88, 18, 112, -191, 20, 195, 2, -156, 217, -89, -14, 124, 21, 5, 216, -151, 117, 64, 116, -19, 138, -69, 97, 115, 89, 68, 56, -69
   };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden0[i] != out0_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden0[i], out0[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
