/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    12025242284002507962, 9259696949444591320, 10635650348688524252, 926140911575334826, 4718955837017499582, 10568547640766546216, 12757436502680005067, 17222587580376949276, 1105337565867559278, 18073091272228543407, 14846952647541316377, 695946246246168189, 14297512804794086522, 14144701497458292368, 10308363154027324184, 9987022898581415778
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    8298538537022903997, 10602636354599420816, 12687906232958975517, 9937364628603096811, 3366158883805574561, 7740938590118113995, 2483743319351599238, 13534852439926676030, 8901135255692097549, 3449874230115086127, 12957419630311453660, 13436865966000182830, 481143291867705474, 3939154507090139818, 17517342457731983429, 9253251752206879118
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m8(size_t avl);
    const int out_data[] = {
    16991308600602260777, 12758384308037203982, 7163356082698943086, 5095961136946150248, 17029875141788573936, 11688253728612289299, 11151698161453163983, 2641422712370927157, 1300324048256793573, 10535321896329282829, 9566395599839910434, 2342148092356426801, 6471637966929216987, 3885253424857215900, 2256919729793657950, 7111409553263363790
    };
    const int64_t *out = &out_data[0];
    bool8_t masked[] = {
    0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0
    };
    const bool8_t *mask = &masked[0];
    vint64m8_t data1_v = __riscv_vle64_v_i64m8_m (mask, *in1, vl);
    vint64m8_t data2_v = __riscv_vle64_v_i64m8_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        void vint8_t __riscv_vse64m8_v_i64 (vbool64_t mask, int64m8_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    20323780821025411959, 19862333304044012136, 23323556581647499770, 10863505540178431638, 8085114720823074143, 18309486230884660212, 15241179822031604306, 30757440020303625307, 10006472821559656828, 21522965502343629534, 27804372277852770038, 14132812212246351019, 14778656096661791997, 18083856004548432186, 27825705611759307614, 19240274650788294896
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
