/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint8mf8_t data1[] = {
    23, 246, 228, 136, 36, 111, 96, 210, 111, 244, 214, 209, 235, 21, 47, 10, 208, 107, 52, 47, 69, 63, 232, 151, 216, 13, 164, 36, 63, 73, 84, 100, 183, 0, 178, 144, 121, 160, 210, 154, 173, 26, 86, 65, 144, 178, 206, 55, 105, 159, 99, 191, 115, 216, 112, 39, 39, 103, 204, 49, 140, 95, 249, 24
    };
    const vint8mf8_t *in1 = &data1[0];
    vint8mf8_t data2[] = {
    231, 101, 96, 88, 223, 133, 134, 75, 166, 102, 182, 71, 82, 64, 102, 220, 137, 112, 208, 32, 29, 247, 251, 171, 7, 214, 127, 2, 14, 230, 233, 39, 110, 148, 15, 97, 242, 248, 147, 167, 40, 4, 178, 223, 225, 52, 249, 28, 185, 249, 1, 34, 97, 114, 112, 233, 227, 163, 236, 162, 130, 242, 239, 16
    };
    const vint8mf8_t *in2 = &data2[0];
    vint8mf8_t out_data[] = {
    56, 157, 66, 144, 189, 228, 210, 161, 213, 203, 203, 86, 37, 45, 121, 227, 59, 30, 66, 133, 237, 31, 250, 161, 161, 162, 15, 2, 97, 238, 1, 209, 18, 153, 162, 116, 121, 243, 96, 30, 97, 191, 216, 221, 229, 72, 211, 70, 168, 25, 111, 174, 72, 160, 199, 251, 119, 110, 192, 133, 245, 93, 147, 137
    };
    vint8mf8_t *out = &out_data[0];
    int masked[] = {
    0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0
    };
    const int *mask = &masked[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint8mf8_t out = __riscv_vadd_vv_i8mf8_m (, mask, data1, data264);
)        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
        mask += Q_element;
      }
    vint8mf8_t golden[] = {
    56, 347, 66, 224, 259, 228, 230, 161, 277, 346, 396, 280, 37, 85, 149, 227, 345, 30, 66, 133, 98, 31, 250, 322, 161, 162, 291, 38, 77, 303, 1, 139, 18, 148, 193, 116, 363, 243, 357, 30, 213, 30, 216, 288, 369, 230, 455, 70, 168, 25, 100, 225, 72, 330, 199, 272, 119, 110, 440, 211, 245, 337, 147, 137
    };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
