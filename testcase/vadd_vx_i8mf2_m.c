/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint8mf2_t data1[] = {
    94, 71, 36, 58, 69, 242, 53, 108, 132, 117, 224, 162, 111, 176, 151, 162, 254, 233, 109, 204, 18, 30, 253, 193, 185, 238, 73, 237, 25, 163, 175, 159, 219, 170, 104, 150, 189, 13, 40, 171, 15, 42, 32, 123, 249, 125, 143, 201, 140, 61, 132, 161, 21, 65, 252, 105, 114, 125, 47, 222, 118, 154, 134, 164
    };
    const vint8mf2_t *in1 = &data1[0];
    vint8mf2_t data2[] = {
    142, 254, 109, 148, 206, 70, 15, 110, 164, 54, 241, 88, 171, 7, 164, 41, 80, 174, 26, 65, 166, 205, 177, 83, 212, 227, 126, 193, 53, 169, 72, 32, 48, 209, 115, 104, 232, 102, 192, 109, 138, 87, 48, 247, 231, 36, 201, 91, 20, 183, 214, 53, 215, 196, 229, 187, 126, 67, 152, 171, 75, 102, 157, 242
    };
    const vint8mf2_t *in2 = &data2[0];
    vint8mf2_t out_data[] = {
    241, 147, 37, 93, 185, 141, 42, 111, 230, 11, 213, 18, 8, 163, 107, 125, 206, 171, 144, 40, 134, 55, 48, 116, 10, 212, 91, 172, 115, 91, 154, 151, 128, 226, 248, 135, 201, 99, 195, 73, 216, 143, 255, 92, 87, 74, 105, 57, 244, 170, 2, 199, 50, 182, 138, 55, 133, 19, 56, 151, 138, 196, 206, 43
    };
    vint8mf2_t *out = &out_data[0];
    int masked[] = {
    1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1
    };
    const int *mask = &masked[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint8mf2_t out = __riscv_vadd_vx_i8mf2_m (, mask, data1, data264);
)        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
        mask += Q_element;
      }
    vint8mf2_t golden[] = {
    236, 147, 145, 206, 275, 141, 42, 111, 296, 171, 213, 250, 8, 163, 315, 203, 334, 171, 135, 40, 184, 235, 48, 116, 397, 212, 199, 430, 115, 91, 154, 151, 128, 379, 219, 254, 201, 99, 195, 73, 153, 129, 255, 370, 87, 74, 344, 57, 160, 170, 346, 199, 50, 261, 138, 292, 240, 19, 56, 151, 193, 256, 291, 406
    };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
