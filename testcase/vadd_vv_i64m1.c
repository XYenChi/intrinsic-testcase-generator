/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    3727474941285554647, 9219056381111288674, -7260889228291744250, 789680663155995308, -1724967358953073108, 2340486556996423878, 5845768295974055384, 6168440889182534780, 1467394092088948020, -8802947440850096999, -3690154275297643732, 22377734420261780, 4089864979077191882, 1302923827137378496, 4579221481486618785, -8953781391366517701
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    813440110102810495, 8948767147241625002, 5632963174348658227, -6847509444212519507, 6751179641008780695, -2678327178115205502, 274498968747271747, 2720060507609703774, 7082973912153292886, -4275604800229939602, 3687942492887215862, -3632831895321298558, 8067366982722895446, -8674500586480924084, -8365109541081337641, 2750007551461073316
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m1(avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m1_t data1_v = __riscv_vle64_v_i64m1 (*in1, vl);
    vint64m1_t data2_v = __riscv_vle64_v_i64m1 (*in2, vl);
    vint64m1_t out_v = __riscv_vle64_v_i64m1 (*out, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vadd_vv_i64m1 (data1_v, data2_v, vl);
        void __riscv_vse64_v_i64m1 (int64_t *out, vint64m1_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    4407515108380548873, 8436910871804955018, -4229416817053807076, 6132313696317386379, -4427319278630628360, 7385851785981741451, 6731855627580360987, 9708207761513838478, 660461105803449102, -17267405132885397637, 2268278604906050303, -4650633331552349147, 11863498855103000839, -653502233218494644, 4729058959057938587, -3260683743062621567
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
