/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    8813978807429064344, 13821810997724811788, 4626988880962532589, 6398214884418879461, 18129003176777738130, 7783958114504387162, 93180059610680967, 4180254857592033013, 7284478137941598535, 15607917157594326866, 8987869909301870098, 10725137170490575109, 359372185456453856, 863916462679772916, 16674123703878541850, 7304387259978382845
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    10247501014422080366, 15588513159910303512, 10363137604416314625, 14061441559445862370, 1344250531794720752, 2272294847097463152, 3323306686799991012, 14705533549878757389, 14653578099946691941, 3921538509577278069, 4690619841014569412, 323432553579695760, 8516209177666218965, 6578518984226634794, 17073332773080799061, 4428485396446836915
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m1(size_t avl);
    const int out_data[] = {
    14802504054189832286, 3454020420350559202, 7050107670082029087, 8554250256772788390, 12781124911680958766, 13091128963207094064, 2088312503093367018, 15388599332458052292, 17575678780952345934, 11874346519445541081, 14049282586270421222, 7254079156877098831, 2572204869934749341, 17091696613994246566, 2851321128735470401, 13828181342853995698
    };
    const int64_t *out = &out_data[0];
    bool64_t masked[] = {
    0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0
    };
    const bool64_t *mask = &masked[0];
    vint64m1_t data1_v = __riscv_vle64_v_i64m1_m (mask, *in1, vl);
    vint64m1_t data2_v = __riscv_vle64_v_i64m1_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        void vint64_t __riscv_vse64m1_v_i64 (vbool64_t mask, int64m1_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    14802504054189832286, 3454020420350559202, 7050107670082029087, 8554250256772788390, 12781124911680958766, 2272294847097463152, 3323306686799991012, 15388599332458052292, 17575678780952345934, 11874346519445541081, 14049282586270421222, 323432553579695760, 8516209177666218965, 6578518984226634794, 2851321128735470401, 13828181342853995698
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
