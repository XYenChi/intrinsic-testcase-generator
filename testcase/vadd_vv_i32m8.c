/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint32m8_t data1[] = {
    2898114478, 2653678900, 2301151130, 1488223138, 1526026286, 1935778226, 3303640380, 3517606480, 3284850292, 500920726, 2047383839, 3743262672, 1580713638, 4042390714, 2722673832, 2873242073, 4278923577, 2818856299, 1303894481, 1333409564, 379366264, 2468971696, 1522598368, 2917237054, 3037443925, 1746299443, 703638192, 3068088186, 3263659736, 2911412461, 1931361597, 685573849
    };
    const vint32m8_t *in1 = &data1[0];
    vint32m8_t data2[] = {
    3279572646, 3185612338, 2673292936, 2191528236, 3188179163, 3559165492, 17264113, 2675266435, 3531008167, 2809303916, 3519741083, 4259935600, 1520635972, 3644791386, 722378926, 1703244275, 1941478575, 4116728540, 3711680422, 3571738223, 1610985753, 802980978, 3901335221, 3460832232, 3985105679, 909638021, 2019228595, 3334519837, 2436558988, 2973740398, 1444870186, 3284220806
    };
    const vint32m8_t *in2 = &data2[0];
    vint32m8_t out_data[64];
    vint32m8_t *out = &out_data[0];
    for (int n = 32, Q_element = 32;n >= 0; n -= Q_element) {
        vint32m8_t out = __riscv_vadd_vv_i32m8 (data1, data2, 64);
        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
      }
    vint32m8_t golden[] = {
    6177687124, 5839291238, 4974444066, 3679751374, 4714205449, 5494943718, 3320904493, 6192872915, 6815858459, 3310224642, 5567124922, 8003198272, 3101349610, 7687182100, 3445052758, 4576486348, 6220402152, 6935584839, 5015574903, 4905147787, 1990352017, 3271952674, 5423933589, 6378069286, 7022549604, 2655937464, 2722866787, 6402608023, 5700218724, 5885152859, 3376231783, 3969794655
    };
    int fail = 0;
    for (int i = 0; i < 32; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
