/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const uint64_t data1[] = {
    12587238907839605455, 3233553581282860514, 16862707958804939497, 11594724200290743668, 9665566649276013591, 6563135838804696324, 18064891922492873929, 13313592760848545786, 9917201590592195563, 14807553141043888163, 10277029316930894345, 12302449089501349092, 9340397873310674809, 8286407184272026352, 16538937512921975855, 2472923067835998434
    };
    const uint64_t *in1 = &data1[0];
    const uint64_t data2[] = {
    500115497921026954, 4470463063662371688, 14787681611478300568, 4660231080448231296, 11299901782876339240, 13979849225394888852, 2217707106090742311, 3702262217714750172, 11195824970433174589, 5373909692610101175, 7669562301239597066, 16694660872840524637, 15685671835840522218, 16061462721137694500, 11510629890087771510, 12629612005444994650
    };
    const uint64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m4(avl);
    const uint64_t out_data[16];
    const uint64_t *out = &out_data[0];
    vuint64m4_t data1_v = __riscv_vle64_v_u64m4 (in1, vl);
    vuint64m4_t data2_v = __riscv_vle64_v_u64m4 (in2, vl);
    vuint64m4_t out_v = __riscv_vle64_v_u64m4 (out, vl);
    for (size_t n = 0; n < vl; n++) {
		out = __riscv_vadd_vv_u64m4(op1, op2, vl);
        void __riscv_vse64_v_u64m4 (uint64_t *out, vuint64m4_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    uint64_t golden[] = {
    13087354405760632409, 7704016644945232202, 13203645496573688449, 16254955280738974964, 2518724358442801215, 2096240990490033560, 1835854954874064624, 17015854978563295958, 2666282487315818536, 1734718759944437722, 17946591618170491411, 10550365888632322113, 6579325635441645411, 5901125831700169236, 9602823329300195749, 15102535073280993084
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const uint64_t data1[] = {
    3695519287858916765, 11793971485997395477, 7536196303165535928, 13938417000881448753, 10550539079477412265, 1484952125655228211, 16541700358478544164, 12795074693169458715, 8750111113215113772, 8456022302838589658, 8863611293492143119, 10921876826031768457, 2663963219331025387, 2468014956131640676, 8127350205806133086, 12222675601111229987
    };
    const uint64_t *in1 = &data1[0];
    const uint64_t data2[] = {
    12378348162794069095, 14891161251384487755, 7569608756108391078, 14328889821005968202, 2815745148167434765, 658202679327851939, 12999342481273943982, 7818889957597121392, 17129063311447494477, 4711074986084181530, 14670710228035485643, 15577721688214697270, 14964787588841475317, 15121920404777791320, 644140649554974989, 18361180733412377720
    };
    const uint64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m4(avl);
    const uint64_t out_data[16];
    const uint64_t *out = &out_data[0];
    vuint64m4_t data1_v = __riscv_vle64_v_u64m4 (in1, vl);
    vuint64m4_t data2_v = __riscv_vle64_v_u64m4 (in2, vl);
    vuint64m4_t out_v = __riscv_vle64_v_u64m4 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_u64m4 (uint64_t *out, vuint64m4_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    uint64_t golden[] = {
    16073867450652985860, 8238388663672331616, 15105805059273927006, 9820562748177865339, 13366284227644847030, 2143154804983080150, 11094298766042936530, 2167220577057028491, 7432430350953056633, 13167097288922771188, 5087577447818077146, 8052854440536914111, 17628750808172500704, 17589935360909431996, 8771490855361108075, 12137112260814056091
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
