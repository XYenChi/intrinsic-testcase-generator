/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    5807715514014338287, 15657163044607290329, 824239407359459065, 2634580744743527822, 14890716458023520866, 1474839336395222891, 8313933848497547466, 14261745445316168876, 4226056133567982155, 8450309552347869475, 7584158714056350815, 16907285370122540264, 12918348941008773629, 5703640370709797848, 5836595422122434369, 7298363595088810288
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    7321811160649146687, 4557903128794806334, 18187211430145076597, 14823293212929613030, 6556841395658674893, 14951263014379433993, 4559783823175857026, 5517639389130959292, 444170911526012504, 552150798952273395, 12149293565955194113, 5372210019954776742, 3110349860135527078, 10977890881320456876, 3568596103474532595, 9991728296845941609
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m8(size_t avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m8_t data1_v = __riscv_vle64_v_i64m8 (*in1, vl);
    vint64m8_t data2_v = __riscv_vle64_v_i64m8 (*in2, vl);
    vint64m8_t out_v = __riscv_vle64_v_i64m8 (*out, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vsub_vx_u64m8 (data1_v, data2_v, vl);
        void vint64m8_t __riscv_vse64_v_i64 (int64m8_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    -1514095646634808400, 11099259915812483995, -17362972022785617532, -12188712468186085208, 8333875062364845973, -13476423677984211102, 3754150025321690440, 8744106056185209584, 3781885222041969651, 7898158753395596080, -4565134851898843298, 11535075350167763522, 9807999080873246551, -5274250510610659028, 2267999318647901774, -2693364701757131321
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
