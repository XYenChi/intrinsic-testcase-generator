/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    3023537895265941541, 3303809011598247632, -2057563260641677863, 2585750564355106429, 8104930015482632602, -1065194600542194954, 375555831094514341, -1391340951963528976, -463075642798930473, 8193030536837342073, -3370830523192383774, -5078830821868388797, -3052515321800852116, -7899330632312001328, -63567159922769023, -7972577251823991621
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    -8539446989646644908, 2343365996035058113, 6268577858165373288, 6586226501073191385, -8060938680942493488, -4642445811287867037, 1379082046779656036, 1388830398853184413, 7583824331706920232, -7110724644370113069, 5252665864711948003, 4761968074119098605, -6623882400977391198, -8188678170889762668, -75517969284336280, -7373315180547103883
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m1(avl);
    const int out_data[] = {
    1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1
    };
    const int64_t *out = &out_data[0];
    uint64_t masked[] = {
    0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0
    };
    const uint64_t *mask = &masked[0];
    vint64m1_t data1_v = __riscv_vle64_v_i64m1 (in1, vl);
    vint64m1_t data2_v = __riscv_vle64_v_i64m1 (in2, vl);
    vint64m1_t out_v = __riscv_vle64_v_i64m1 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_i64m1 (int64_t *out, vint64m1_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    1, 5647175007633305745, 1, 1, 43991334540139114, 1, 1754637877874170377, 0, 7120748688907989759, 1082305892467229004, 1881835341519564229, 18129881325960261424, 1, 2358735270507787620, 18307658944502446313, 1
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
