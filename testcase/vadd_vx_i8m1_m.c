/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint8m1_t data1[] = {
    11, 27, 44, 199, 231, 50, 183, 71, 252, 247, 48, 217, 185, 245, 171, 141, 190, 30, 87, 42, 253, 42, 215, 245, 147, 33, 114, 65, 168, 190, 3, 254, 140, 214, 217, 197, 127, 61, 68, 182, 47, 229, 207, 6, 133, 120, 40, 52, 249, 219, 197, 111, 121, 182, 85, 1, 175, 155, 33, 108, 210, 66, 74, 112
    };
    const vint8m1_t *in1 = &data1[0];
    vint8m1_t data2[] = {
    193, 223, 81, 234, 2, 231, 200, 187, 197, 93, 89, 187, 226, 211, 211, 56, 244, 94, 133, 33, 117, 2, 40, 145, 121, 203, 207, 45, 122, 38, 95, 105, 76, 102, 238, 119, 194, 118, 121, 219, 249, 48, 103, 31, 165, 108, 228, 70, 205, 58, 48, 37, 67, 236, 69, 243, 4, 140, 155, 167, 151, 57, 123, 179
    };
    const vint8m1_t *in2 = &data2[0];
    vint8m1_t out_data[] = {
    83, 122, 188, 41, 88, 161, 146, 214, 140, 193, 182, 44, 100, 47, 229, 135, 28, 63, 69, 33, 54, 75, 99, 155, 55, 248, 173, 205, 205, 70, 65, 159, 214, 216, 13, 85, 65, 23, 82, 210, 112, 25, 70, 121, 116, 225, 23, 27, 128, 130, 54, 171, 219, 56, 232, 38, 14, 107, 172, 188, 72, 190, 254, 49
    };
    vint8m1_t *out = &out_data[0];
    int masked[] = {
    0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1
    };
    const int *mask = &masked[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint8m1_t out = __riscv_vadd_vx_i8m1_m (, mask, data1, data264);
)        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
        mask += Q_element;
      }
    vint8m1_t golden[] = {
    83, 122, 188, 41, 233, 281, 146, 214, 140, 193, 137, 404, 411, 47, 229, 135, 28, 124, 69, 33, 54, 75, 255, 390, 268, 236, 173, 110, 205, 228, 65, 159, 216, 216, 455, 85, 65, 179, 189, 401, 296, 277, 70, 121, 116, 225, 268, 122, 128, 277, 54, 171, 188, 56, 232, 38, 179, 295, 188, 188, 72, 190, 197, 291
    };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
