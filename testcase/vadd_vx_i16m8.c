/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint16m8_t data1[] = {
    246, 214, 100, 220, 167, 39, 30, 122, 232, 111, 146, 183, 201, 88, 124, 163, 5, 252, 91, 96, 136, 29, 131, 201, 123, 100, 113, 141, 179, 110, 170, 131, 87, 186, 200, 146, 68, 128, 157, 35, 181, 45, 227, 78, 136, 255, 214, 61, 70, 121, 130, 191, 42, 34, 163, 28, 239, 231, 75, 239, 19, 99, 46, 193
    };
    const vint16m8_t *in1 = &data1[0];
    vint16m8_t data2[] = {
    157, 33, 199, 79, 2, 25, 233, 95, 82, 250, 254, 29, 88, 247, 119, 145, 251, 54, 139, 219, 109, 126, 112, 62, 245, 148, 46, 60, 225, 74, 135, 234, 204, 168, 37, 1, 154, 184, 97, 157, 197, 178, 18, 145, 222, 16, 20, 11, 245, 1, 145, 173, 14, 189, 123, 212, 252, 34, 168, 191, 231, 238, 187, 115
    };
    const vint16m8_t *in2 = &data2[0];
    vint16m8_t out_data[64];
    vint16m8_t *out = &out_data[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint16m8_t out = __riscv_vadd_vx_i16m8 (data1, data2, 64);
        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
      }
    vint16m8_t golden[] = {
    403, 247, 299, 299, 169, 64, 263, 217, 314, 361, 400, 212, 289, 335, 243, 308, 256, 306, 230, 315, 245, 155, 243, 263, 368, 248, 159, 201, 404, 184, 305, 365, 291, 354, 237, 147, 222, 312, 254, 192, 378, 223, 245, 223, 358, 271, 234, 72, 315, 122, 275, 364, 56, 223, 286, 240, 491, 265, 243, 430, 250, 337, 233, 308
    };
    int fail = 0;
    for (int i = 0; i < 64; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
