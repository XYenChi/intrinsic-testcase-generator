/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint64m1_t data1[] = {
    43, 64, 137, 184, 184, 29, 216, 230, 86, 170, 137, 238, 71, 6, 205, 156, 190, 66, 152, 213, 222, 213, 37, 197, 220, 52, 252, 90, 191, 137, 190, 96, 143, 239, 149, 70, 2, 116, 142, 231, 243, 211, 127, 208, 235, 6, 170, 228, 168, 254, 19, 77, 167, 30, 111, 32, 163, 221, 104, 96, 192, 22, 154, 93
    };
    const vint64m1_t *in1 = &data1[0];
    vint64m1_t data2[] = {
    111, 10, 225, 118, 214, 128, 182, 42, 182, 252, 16, 67, 208, 206, 235, 187, 167, 109, 135, 206, 3, 67, 110, 218, 1, 181, 64, 57, 158, 109, 225, 34, 39, 165, 216, 188, 3, 109, 75, 106, 240, 107, 73, 181, 251, 88, 27, 41, 102, 31, 180, 158, 142, 121, 84, 198, 58, 248, 183, 243, 232, 74, 228, 223
    };
    const vint64m1_t *in2 = &data2[0];
    vint64m1_t out_data[64];
    vint64m1_t *out = &out_data[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint64m1_t out = __riscv_vadd_vx_i64m1 (data1, data2, 64);
        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
      }
    vint64m1_t golden[] = {
    154, 74, 362, 302, 398, 157, 398, 272, 268, 422, 153, 305, 279, 212, 440, 343, 357, 175, 287, 419, 225, 280, 147, 415, 221, 233, 316, 147, 349, 246, 415, 130, 182, 404, 365, 258, 5, 225, 217, 337, 483, 318, 200, 389, 486, 94, 197, 269, 270, 285, 199, 235, 309, 151, 195, 230, 221, 469, 287, 339, 424, 96, 382, 316
    };
    int fail = 0;
    for (int i = 0; i < 64; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
