/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const uint64_t data1[] = {
    6728887910995186028, 17160110403467560, 12367908811965155224, 16684522135918599710, 5691473064853952916, 10960253476055893501, 3146186994303630247, 4592370549166043405, 13704980619866886058, 6836254153082514191, 10649675539135789585, 4777276198892706806, 5790836430007910610, 4764343404651608920, 3466506759821731656, 8781318510098341367
    };
    const uint64_t *in1 = &data1[0];
    const uint64_t data2[] = {
    9429073292949908652, 3108495326982018884, 17698336103177956864, 16524590590336744769, 14616329092922260439, 6681360029741563280, 7987116824462912824, 13836800109565782944, 9205931491570627859, 4185130966564370307, 15246554104327317188, 5717583884065333462, 12611707559935777960, 11422458401135286225, 2978234997953592805, 14607305028010393495
    };
    const uint64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m2(avl);
    const uint64_t out_data[16];
    const uint64_t *out = &out_data[0];
    vuint64m2_t data1_v = __riscv_vle64_v_u64m2 (in1, vl);
    vuint64m2_t data2_v = __riscv_vle64_v_u64m2 (in2, vl);
    vuint64m2_t out_v = __riscv_vle64_v_u64m2 (out, vl);
    for (size_t n = 0; n < vl; n++) {
		out = __riscv_vadd_vx_u64m2(op1, op2, vl);
        void __riscv_vse64_v_u64m2 (uint64_t *out, vuint64m2_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    uint64_t golden[] = {
    16157961203945094680, 3125655437385486444, 11619500841433560472, 14762368652545792863, 1861058084066661739, 17641613505797456781, 11133303818766543071, 18429170658731826349, 4464168037727962301, 11021385119646884498, 7449485569753555157, 10494860082958040268, 18402543989943688570, 16186801805786895145, 6444741757775324461, 4941879464399183246
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const uint64_t data1[] = {
    5762474455967983058, 6057256407841394671, 10519768870077005100, 12131824809441469565, 3906606983957795668, 16121608423259900964, 2173519505228663132, 1224326275673189410, 5785466488954357262, 8698025268700921028, 14763094867816338293, 2697223492822863122, 4930168159816545581, 16212331911198147577, 17148311871666096830, 1503938179152481154
    };
    const uint64_t *in1 = &data1[0];
    const uint64_t data2[] = {
    1450637876847026359, 6928135409083094514, 5064149374787099604, 14241127972814099149, 6250178354559284380, 897142740062094108, 3820197003519249334, 145418356838088155, 1909344534808153594, 5048794522083735290, 6692293094971188326, 9214322166034317405, 14755062435545694058, 17421686558862951770, 13214877622125373093, 12620996197876187727
    };
    const uint64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m2(avl);
    const uint64_t out_data[16];
    const uint64_t *out = &out_data[0];
    vuint64m2_t data1_v = __riscv_vle64_v_u64m2 (in1, vl);
    vuint64m2_t data2_v = __riscv_vle64_v_u64m2 (in2, vl);
    vuint64m2_t out_v = __riscv_vle64_v_u64m2 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_u64m2 (uint64_t *out, vuint64m2_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    uint64_t golden[] = {
    7213112332815009417, 12985391816924489185, 15583918244864104704, 7926208708546017098, 10156785338517080048, 17018751163321995072, 5993716508747912466, 1369744632511277565, 7694811023762510856, 13746819790784656318, 3008643889077975003, 11911545658857180527, 1238486521652688023, 15187274396351547731, 11916445420081918307, 14124934377028668881
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
