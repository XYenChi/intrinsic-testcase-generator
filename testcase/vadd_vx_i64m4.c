/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    -9015966819712925881, 5124114260029902321, 7485306538934976562, 5136840095960171641, -2870019050647045002, 6229871365580392088, -5605469334164420851, -2817032300141889092, -6059056305274286632, -3770889492904844470, 5351597998775322435, 1275686064734887027, 6939892504699962633, -7266455264838149247, -2144699494119370605, -3507612466632925839
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    1449814997162592687, 9080252216031064087, -8844284143365773594, -2407129678335102016, 7525047468950021039, 2621055372598570183, -6235253372649295078, 4670191741725709528, 8245539772391558345, 7324408737567734066, -2187558289363573766, -7547023982409378221, 1741987245393786163, 874303849743021346, 4472560318606459087, -4299691783610189604
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m4(avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m4_t data1_v = __riscv_vle64_v_i64m4 (in1, vl);
    vint64m4_t data2_v = __riscv_vle64_v_i64m4 (in2, vl);
    vint64m4_t out_v = __riscv_vle64_v_i64m4 (out, vl);
    for (size_t n = 0; n < vl; n++) {
		out = __riscv_vadd_vx_i64m4(op1, op2, vl);
        void __riscv_vse64_v_i64m4 (int64_t *out, vint64m4_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    10880592251159218422, 14204366476060966408, 17087766469278754584, 2729710417625069625, 4655028418302976037, 8850926738178962271, 6606021366895835687, 1853159441583820436, 2186483467117271713, 3553519244662889596, 3164039709411748669, 12175406156035060422, 8681879750093748796, 12054592658614423715, 2327860824487088482, 10639439823466436173
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    -3570926261853214501, 7442915728841774730, 8274598242821895186, 1900927435792896161, 6190405032084770596, 191528883836939942, 1544406506018053223, 8567674939545197131, -5570445482131664993, 2238925980665116678, 284375299280991525, -975401795687077280, 1472649320435445077, 258742261768598503, 8074396795098027436, -8475712255803954338
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    7094996312409543446, 8420853083039574433, 7325265661910562567, -8865185038667289062, 6416639913417988720, -6028273560118685839, 4209353653542533801, 941916792318117124, -2934867331983759637, -8596501967326240826, -7453034418810095518, 1868302874207668154, 8158097320413733755, 7852483105863013528, -3814207695591230948, -1741100420745521140
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m4(avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m4_t data1_v = __riscv_vle64_v_i64m4 (in1, vl);
    vint64m4_t data2_v = __riscv_vle64_v_i64m4 (in2, vl);
    vint64m4_t out_v = __riscv_vle64_v_i64m4 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_i64m4 (int64_t *out, vint64m4_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    3524070050556328945, 15863768811881349163, 15599863904732457753, 11482486470835158715, 12607044945502759316, 12609999397427805719, 5753760159560587024, 9509591731863314255, 9941431259594126986, 12089168087048427468, 11278084954180447623, 892901078520590874, 9630746640849178832, 8111225367631612031, 4260189099506796488, 8229931397160076138
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
