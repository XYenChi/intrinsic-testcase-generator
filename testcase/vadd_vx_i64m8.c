/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint64m8_t data1[] = {
    254, 153, 168, 54, 142, 141, 105, 58, 18, 216, 245, 30, 46, 133, 89, 202, 8, 20, 188, 224, 250, 227, 166, 12, 84, 75, 78, 219, 61, 147, 101, 236, 119, 182, 149, 172, 183, 200, 111, 52, 131, 10, 14, 9, 254, 44, 217, 71, 243, 130, 114, 204, 206, 217, 93, 198, 183, 240, 114, 172, 39, 100, 155, 70
    };
    const vint64m8_t *in1 = &data1[0];
    vint64m8_t data2[] = {
    147, 174, 17, 41, 56, 147, 35, 206, 83, 190, 2, 124, 152, 103, 28, 76, 233, 146, 41, 52, 250, 147, 139, 136, 177, 200, 129, 26, 56, 236, 60, 224, 253, 32, 194, 182, 54, 75, 136, 107, 39, 199, 213, 215, 104, 84, 3, 180, 225, 223, 5, 144, 92, 1, 219, 31, 96, 165, 76, 225, 163, 148, 66, 213
    };
    const vint64m8_t *in2 = &data2[0];
    vint64m8_t out_data[64];
    vint64m8_t *out = &out_data[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint64m8_t out = __riscv_vadd_vx_i64m8 (data1, data2, 64);
)        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
      }
    vint64m8_t golden[] = {
    401, 327, 185, 95, 198, 288, 140, 264, 101, 406, 247, 154, 198, 236, 117, 278, 241, 166, 229, 276, 500, 374, 305, 148, 261, 275, 207, 245, 117, 383, 161, 460, 372, 214, 343, 354, 237, 275, 247, 159, 170, 209, 227, 224, 358, 128, 220, 251, 468, 353, 119, 348, 298, 218, 312, 229, 279, 405, 190, 397, 202, 248, 221, 283
    };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
