/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const uint64_t data1[] = {
    15985845294112954130, 14154706129318752639, 14509904179127359116, 14031394166238656930, 9776246405400077895, 8578622726850043628, 7286149886860452299, 12050956000129703547, 14034667960118604314, 9642397407382382352, 3816152063403610271, 6623790123761463487, 16687811917931125777, 9011080646176574089, 6032956624569431210, 12624129899186151497
    };
    const uint64_t *in1 = &data1[0];
    const uint64_t data2[] = {
    3752721854771141136, 13949408653097053167, 17595254718156218976, 18116686820648358377, 3687558306636387429, 10929432407671970496, 15953996404033472677, 14434338403759078949, 15024478607827877320, 13079618935368620524, 13044909322940871257, 9461698257600671241, 17254697152365039344, 15970346736730600485, 14695839231127386230, 1931559396130992552
    };
    const uint64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m4(avl);
    const uint64_t out_data[16];
    const uint64_t *out = &out_data[0];
    vuint64m4_t data1_v = __riscv_vle64_v_u64m4 (in1, vl);
    vuint64m4_t data2_v = __riscv_vle64_v_u64m4 (in2, vl);
    vuint64m4_t out_v = __riscv_vle64_v_u64m4 (out, vl);
    for (size_t n = 0; n < vl; n++) {
		out = __riscv_vadd_vx_u64m4(op1, op2, vl);
        void __riscv_vse64_v_u64m4 (uint64_t *out, vuint64m4_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    uint64_t golden[] = {
    1291823075174543650, 9657370708706254190, 13658414823574026476, 13701336913177463691, 13463804712036465324, 1061311060812462508, 4793402217184373360, 8038550330179230880, 10612402494236930018, 4275272269041451260, 16861061386344481528, 16085488381362134728, 15495764996586613505, 6534683309197622958, 2282051781987265824, 14555689295317144049
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const uint64_t data1[] = {
    2642244467517993764, 10525232924436414164, 447334091176626943, 13520620613264385394, 17344042400045637631, 15235847636584701815, 5413117222215555320, 4970788461485656870, 5991202216477659607, 2301782943956529914, 17436004962886186170, 6484429270351476476, 4448621393514777057, 2436003787673431495, 17225023056614607507, 15797897159425198034
    };
    const uint64_t *in1 = &data1[0];
    const uint64_t data2[] = {
    11854880557152477417, 12942177737490178306, 12040671301714419058, 9837335759069515871, 17048572298864822262, 7744152761244648446, 1183535593525919398, 5011262757380078022, 16543987222452071231, 7820861413405608901, 6177021336251586944, 15486092889996385138, 4894370305080913813, 12867688832188022317, 6188336224719195316, 14112900692116253893
    };
    const uint64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m4(avl);
    const uint64_t out_data[16];
    const uint64_t *out = &out_data[0];
    vuint64m4_t data1_v = __riscv_vle64_v_u64m4 (in1, vl);
    vuint64m4_t data2_v = __riscv_vle64_v_u64m4 (in2, vl);
    vuint64m4_t out_v = __riscv_vle64_v_u64m4 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_u64m4 (uint64_t *out, vuint64m4_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    uint64_t golden[] = {
    14497125024670471181, 5020666588217040854, 12488005392891046001, 4911212298624349649, 15945870625200908277, 4533256324119798645, 6596652815741474718, 9982051218865734892, 4088445365220179222, 10122644357362138815, 5166282225428221498, 3523778086638309998, 9342991698595690870, 15303692619861453812, 4966615207624251207, 11464053777831900311
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
