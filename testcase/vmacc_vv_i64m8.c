/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    16045725107957605601, 3729777693789293856, 15640993798588660032, 6521959623554133031, 7872523344240527109, 7828720524682914414, 13588401154270186038, 6617692408808387195, 1775736478272082778, 4753917509644050505, 13637224254018969279, 5532830112787085903, 15743242828984893472, 17843736804219358181, 7020031081861891293, 13284924624865383971
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    6175507927730753414, 5921526910328857775, 2474371986052399153, 1137367116103826378, 1087234822282143831, 9573288560268042488, 5294612846918382957, 8511616847737457749, 3608649411490061432, 5947057098027523137, 5945362232555239611, 5954573874320468827, 4407307430821450713, 16653588571629702199, 4610861904892860874, 5980537283616899057
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m8(size_t avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m8_t data1_v = __riscv_vle64_v_i64m8 (*in1, vl);
    vint64m8_t data2_v = __riscv_vle64_v_i64m8 (*in2, vl);
    vint64m8_t out_v = __riscv_vle64_v_i64m8 (*out, vl);
    const int out_data[] = {
    13162995664039996760, 7882437110995196397, 5750752669843225752, 12079951153630294595, 6052992784010395184, 1595894496235469868, 2878122122563909746, 12498250113705771862, 671259772182586590, 883698493099366897, 5552962920557577609, 15713414142008822589, 5860445449711306660, 12932462490830252195, 8834002561134287457, 4425713980562636708
    };
    const int64_t *out = &out_data[0];
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmacc_vv_i64m8 (data1_v, data2_v, vl);
        void vint64m8_t __riscv_vse64_v_i64 (int64m8_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    99090502610380592584823633651236268574, 22085978983317609839708280567300526797, 38701636889247081553333714602924978648, 7417862408387361412604628869169186313, 8559281519087378118573736486003009763, 74946600640482571915893872126855091900, 71945323320479510787443632901082464112, 56327262199957748203733545271850895917, 6408010397277985776640857301991804686, 28271818869165976733019065006383401082, 81078238036730681258409091337650488078, 32945645640655554634546067484091468370, 69385311105411638409566320218514752196, 297162251317915808296983574166774592214, 32368393886520811048375378240295257539, 79450987029047675172497338897215452055
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
