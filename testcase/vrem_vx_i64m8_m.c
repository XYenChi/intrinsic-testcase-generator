/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    12191847718535209069, 16309622547858258312, 2706925568801133317, 12202387335526182801, 14805664395596769112, 4248665421406685323, 2416486332620861288, 2361648968837661077, 5081876530526501603, 18436580682506649, 16109567094995457602, 2140434766528645029, 14728657947885374361, 71135315979426941, 16819545512209451612, 7140353417969928989
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    9774909182753219714, 1111185497648329042, 13370184967138630585, 14801880419509124343, 11522324415622194366, 5384925630353569497, 10058877048951942593, 1890517146111526753, 16809740187366174775, 6472790448999618183, 18060409440070665000, 18144680999161292342, 5892075500333787482, 9081971821021119530, 14036999789496181722, 8505386388448635959
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m8(size_t avl);
    const int out_data[] = {
    4788696413005625928, 7059508772273449479, 7075408945720524644, 7414984274612323592, 5537265487819612668, 6042504677206168072, 573326858662353937, 8498976803235810094, 1012959324600713, 9157587311805653982, 655909724633680934, 9689203478195495383, 14645048477863201158, 17391796569487708615, 3474873981580630908, 15589985234615772095
    };
    const int64_t *out = &out_data[0];
    bool8_t masked[] = {
    0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1
    };
    const bool8_t *mask = &masked[0];
    vint64m8_t data1_v = __riscv_vle64_v_i64m8_m (mask, *in1, vl);
    vint64m8_t data2_v = __riscv_vle64_v_i64m8_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vrem_vx_i64m8_m (mask, data1_v, data2_v, vl);
        void vint8_t __riscv_vse64m8_v_i64 (vbool64_t mask, int64m8_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    4788696413005625928, 7059508772273449479, 2542482691934097317, 7414984274612323592, 11522324415622194366, 6042504677206168072, 392931718468497441, 8498976803235810094, 1012959324600713, 1550629439784384, 655909724633680934, 9689203478195495383, 5892075500333787482, 17391796569487708615, 3474873981580630908, 1365032970478706970
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
