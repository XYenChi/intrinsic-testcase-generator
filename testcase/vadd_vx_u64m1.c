/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const uint64_t data1[] = {
    16726591508318422922, 1969392467412853110, 14733723737753547532, 8870346202893255941, 16991141673112227173, 13013619722674946978, 1207738441764925010, 14221937859861485251, 12147195382364482714, 4815833213244450351, 17017498509062955966, 17770147441941692675, 15534646689339961004, 10786722823859664838, 14273153482025217306, 2961627700377577305
    };
    const uint64_t *in1 = &data1[0];
    const uint64_t data2[] = {
    6324935412900822930, 16644074081879752094, 16260844602019368875, 10653548655116690689, 17791847995113246373, 7972431264333340622, 5916925185305904400, 4462733588511575671, 628229183698613155, 2513453272653571103, 3494606121185025077, 14881697047854057284, 13651792754541201780, 13551034357452615063, 7516903708844313581, 9695279522632788055
    };
    const uint64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m1(avl);
    const uint64_t out_data[16];
    const uint64_t *out = &out_data[0];
    vuint64m1_t data1_v = __riscv_vle64_v_u64m1 (in1, vl);
    vuint64m1_t data2_v = __riscv_vle64_v_u64m1 (in2, vl);
    vuint64m1_t out_v = __riscv_vle64_v_u64m1 (out, vl);
    for (size_t n = 0; n < vl; n++) {
		out = __riscv_vadd_vx_u64m1(op1, op2, vl);
        void __riscv_vse64_v_u64m1 (uint64_t *out, vuint64m1_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    uint64_t golden[] = {
    4604782847509694236, 166722475583053588, 12547824266063364791, 1077150784300395014, 16336245594515921930, 2539306913298735984, 7124663627070829410, 237927374663509306, 12775424566063095869, 7329286485898021454, 2065360556538429427, 14205100416086198343, 10739695370171611168, 5891013107602728285, 3343313117159979271, 12656907223010365360
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const uint64_t data1[] = {
    16924540473057910049, 8729856300161472359, 16322674183189407278, 14231172367478586482, 321653498926648728, 10546496321229834008, 17730955679616966842, 3365982441520745325, 4322643095561072518, 15592333530137201010, 6875068766789246241, 2584940845611598310, 15405693393229779733, 2118465699853631736, 12126785688908524715, 6682872038365212402
    };
    const uint64_t *in1 = &data1[0];
    const uint64_t data2[] = {
    1028120762310641005, 16093233019571106745, 15359779019484062419, 17126219671625439414, 7484227116086212657, 8476610983906745269, 2606532243578005042, 2902498569355217926, 12754722596894709634, 6532514462170537695, 8705251889093711457, 12435681421635548747, 4165845561014854771, 6240952148814805801, 765807995272878933, 14225624310602165081
    };
    const uint64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m1(avl);
    const uint64_t out_data[16];
    const uint64_t *out = &out_data[0];
    vuint64m1_t data1_v = __riscv_vle64_v_u64m1 (in1, vl);
    vuint64m1_t data2_v = __riscv_vle64_v_u64m1 (in2, vl);
    vuint64m1_t out_v = __riscv_vle64_v_u64m1 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_u64m1 (uint64_t *out, vuint64m1_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    uint64_t golden[] = {
    17952661235368551054, 6376345246023027488, 13235709128963918081, 12910647965394474280, 7805880615012861385, 576363231427027661, 1890743849485420268, 6268481010875963251, 17077365692455782152, 3678103918598187089, 15580320655882957698, 15020622267247147057, 1124794880535082888, 8359417848668437537, 12892593684181403648, 2461752275257825867
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
