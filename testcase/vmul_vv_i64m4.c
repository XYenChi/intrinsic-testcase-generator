/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    11213461733798287324, 15578339185156192241, 3058673800541852560, 7365096244058139230, 1447651603065432627, 17695991018123585614, 10818732565738407823, 5320063940082227794, 17572696205262962995, 17980633396179344636, 1807001508780926248, 13896272183205080428, 3466076165403973706, 7290904699265322171, 5724477744859856978, 10052191124105549606
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    11752789911894387292, 12174561588323738459, 5692090220087750430, 12406132703669259246, 14459614976720114222, 1230656025713611769, 108775743632297327, 14116711209990120775, 511369294391726728, 5750487475225159282, 12536320894991386430, 11189195197969973391, 18062184758100496681, 16594892614405063679, 10477969374482569424, 6110059057725024645
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m4(size_t avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m4_t data1_v = __riscv_vle64_v_i64m4 (*in1, vl);
    vint64m4_t data2_v = __riscv_vle64_v_i64m4 (*in2, vl);
    vint64m4_t out_v = __riscv_vle64_v_i64m4 (*out, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmul_vv_i64m4 (data1_v, data2_v, vl);
        void vint64m4_t __riscv_vse64_v_i64 (int64m4_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    131789459942398256644623863237950286608, 189659449853481105359204020058409096619, 17410247226502909598685244995136600800, 91372361379081309293646020931232820580, 20932484800757811629156738783285521194, 21777677977427742285123707340629491166, 1176815679997147337428084536718789121, 75101806260822995312654911893121820350, 8986137259045495257726952403616430360, 103397407141344540688415396881472311352, 22653150771811286966270361837098014640, 155488101982002004242778709427174891348, 62604908085175069935862279529664269786, 120991780546169266802581144989705527109, 59980902495548625265542031914595840672, 61419481427824210695329858587620039870
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
