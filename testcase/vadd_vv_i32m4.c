/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint32m4_t data1[] = {
    191, 162, 157, 212, 173, 141, 175, 241, 135, 158, 183, 53, 19, 173, 161, 104, 5, 198, 48, 72, 171, 149, 77, 127, 126, 240, 243, 202, 15, 113, 166, 119, 30, 15, 1, 83, 241, 198, 151, 201, 250, 125, 221, 76, 143, 178, 198, 144, 80, 118, 1, 60, 206, 123, 253, 124, 8, 241, 198, 226, 102, 171, 133, 90
    };
    const vint32m4_t *in1 = &data1[0];
    vint32m4_t data2[] = {
    17, 110, 59, 110, 25, 38, 148, 82, 62, 14, 228, 72, 218, 231, 207, 175, 205, 154, 71, 192, 209, 195, 243, 91, 21, 163, 219, 36, 161, 90, 143, 221, 161, 20, 114, 79, 62, 114, 100, 143, 206, 221, 65, 29, 96, 25, 96, 71, 65, 186, 49, 89, 247, 38, 85, 74, 41, 36, 175, 211, 44, 185, 255, 81
    };
    const vint32m4_t *in2 = &data2[0];
    vint32m4_t out_data[64];
    vint32m4_t *out = &out_data[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint32m4_t out = __riscv_vadd_vv_i32m4 (data1, data2, 64);
)        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
      }
    vint32m4_t golden[] = {
    208, 272, 216, 322, 198, 179, 323, 323, 197, 172, 411, 125, 237, 404, 368, 279, 210, 352, 119, 264, 380, 344, 320, 218, 147, 403, 462, 238, 176, 203, 309, 340, 191, 35, 115, 162, 303, 312, 251, 344, 456, 346, 286, 105, 239, 203, 294, 215, 145, 304, 50, 149, 453, 161, 338, 198, 49, 277, 373, 437, 146, 356, 388, 171
    };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
