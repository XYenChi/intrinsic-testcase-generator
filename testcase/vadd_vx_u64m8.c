/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const uint64_t data1[] = {
    14514864680414897209, 15713864642381568030, 1954157868666379558, 8489613162423100353, 13753445426383313271, 13910172177462894661, 17509050723827456415, 9223672062123409133, 11386917563872682726, 3393234858609157332, 18252523617381989042, 11284452318529130114, 17736550575859708797, 506043612585115285, 6562957433056237589, 18034728821040722481
    };
    const uint64_t *in1 = &data1[0];
    const uint64_t data2[] = {
    2192518792213933895, 2369907442596721786, 5140228333245893419, 17644040170382988471, 945681300625645165, 15731069805955979281, 10435572995360547145, 18060423902902890595, 5860448744286996536, 378304189382985666, 12393080971104725502, 12863729877938442198, 10062898603451691978, 15573239069065961458, 2550869795959517391, 12993394951094089116
    };
    const uint64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m8(avl);
    const uint64_t out_data[16];
    const uint64_t *out = &out_data[0];
    vuint64m8_t data1_v = __riscv_vle64_v_u64m8 (in1, vl);
    vuint64m8_t data2_v = __riscv_vle64_v_u64m8 (in2, vl);
    vuint64m8_t out_v = __riscv_vle64_v_u64m8 (out, vl);
    for (size_t n = 0; n < vl; n++) {
		out = __riscv_vadd_vx_u64m8(op1, op2, vl);
        void __riscv_vse64_v_u64m8 (uint64_t *out, vuint64m8_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    uint64_t golden[] = {
    16707383472628831104, 18083772084978289816, 7094386201912272977, 7686909259096537208, 14699126727008958436, 11194497909709322326, 9497879645478451944, 8837351891316748112, 17247366308159679262, 3771539047992142998, 12198860514777162928, 5701438122758020696, 9352705105601849159, 16079282681651076743, 9113827229015754980, 12581379698425259981
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const uint64_t data1[] = {
    3828224019128233123, 5071335277611321281, 17943018312389580421, 17070495562326997946, 7808293096580120816, 2541317296950197447, 6433093050776473839, 12184447720702813724, 13898131746883100075, 2001408182318746715, 5978906804871828901, 15879708533470159732, 5384244647898623068, 212847391375779252, 15068804511366394964, 10905838339002892555
    };
    const uint64_t *in1 = &data1[0];
    const uint64_t data2[] = {
    3221474920929925237, 3818091792100474261, 15861731618103834785, 795188651664343583, 5817550997661114516, 18217534303625941678, 14624379281974795207, 5059210253049629245, 8413598702256749970, 9195422798539856339, 3812013754151232164, 5211487847119992847, 969279485151395648, 9498987485688424073, 7886895332551507672, 2526818015158625126
    };
    const uint64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m8(avl);
    const uint64_t out_data[16];
    const uint64_t *out = &out_data[0];
    vuint64m8_t data1_v = __riscv_vle64_v_u64m8 (in1, vl);
    vuint64m8_t data2_v = __riscv_vle64_v_u64m8 (in2, vl);
    vuint64m8_t out_v = __riscv_vle64_v_u64m8 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_u64m8 (uint64_t *out, vuint64m8_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    uint64_t golden[] = {
    7049698940058158360, 8889427069711795542, 15358005856783863590, 17865684213991341529, 13625844094241235332, 2312107526866587509, 2610728259041717430, 17243657973752442969, 3864986375430298429, 11196830980858603054, 9790920559023061065, 2644452306880600963, 6353524133050018716, 9711834877064203325, 4508955770208351020, 13432656354161517681
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
