/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    6046983191546983807, -8992473722979535069, 5183932967345313888, 5466356792053259760, -1421000612800080729, -291708207936750723, 1850452839094984883, -8545694103994394356, -5447900873255782478, 7603815994163330211, 8787059318232462579, -9056265511187829734, 8981584410529902841, -6531637581089237780, 710866726725399863, -8944505383811907434
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    4540684899572636436, -1436903616383787123, 6729656634992464702, 3946336696129967075, -4213239551006151765, 1551843315511783201, -4356320236161728744, 26558859773654784, 8737423526617757639, 2441924228810983426, -2942968041593030502, -36055765034073624, 6834525327708944030, -6583611492829885856, 4577224486152553756, -1942532551760933119
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m8(avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m8_t data1_v = __riscv_vle64_v_i64m8 (*in1, vl);
    vint64m8_t data2_v = __riscv_vle64_v_i64m8 (*in2, vl);
    vint64m8_t out_v = __riscv_vle64_v_i64m8 (*out, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vadd_vx_u64m8 (data1_v, data2_v, vl);
        void __riscv_vse64_v_i64m8 (int64_t *out, vint64m8_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    54482019729938699, -10715989128440644500, 4321232592853565781, 11632371339331286246, 1970580783594062998, 6700379447868522263, 6977501277272042765, -13244168733041601660, -5471166695204928363, 6911040685646649052, 9485891040844533501, -9316974318252272286, 6043724752035022659, -14085247689777578779, -3821650505646939847, -5390755479973081864
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
