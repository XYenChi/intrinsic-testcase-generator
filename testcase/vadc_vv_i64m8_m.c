/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    1587246067024376353, 16899293779528926624, 8017701738999967140, 15369174379159655454, 10932281730888432447, 649043090768926218, 2995588603310337986, 11268261065152315697, 2297731718176712648, 4259298773100777624, 14170455364599942209, 4974909839532069354, 6683157975202960538, 13678848475102693892, 1063797309080156839, 12119338135640832027
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    3713331214923418195, 13851217785532350847, 10887068221663990990, 10849183370799962457, 11331476526551166237, 10524782828129449722, 460978364751831473, 5718618178477971660, 13550135843166949667, 8278931259307228736, 3896316868142583148, 9305542788189780554, 15278159222509087936, 18096402598780805032, 4647567429820745234, 10631959096170877566
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m8(size_t avl);
    const int out_data[] = {
    11245443981066838577, 16264611026732353849, 7359206233403214473, 17084856958428067855, 9925555485839047952, 8185698253582417274, 7409346385597460738, 1182862374165524304, 13491204302531930393, 5056168716544377275, 5176359964057197575, 6262438941266316768, 1858785572450442271, 10372978628546359650, 7552170427194195926, 12817228828323583472
    };
    const int64_t *out = &out_data[0];
    bool8_t masked[] = {
    0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0
    };
    const bool8_t *mask = &masked[0];
    vint64m8_t data1_v = __riscv_vle64_v_i64m8_m (mask, *in1, vl);
    vint64m8_t data2_v = __riscv_vle64_v_i64m8_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        void vint8_t __riscv_vse64m8_v_i64 (vbool64_t mask, int64m8_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    5300577281947794548, 30750511565061277471, 18904769960663958131, 26218357749959617912, 22263758257439598684, 11173825918898375940, 3456566968062169459, 16986879243630287358, 15847867561343662315, 12538230032408006361, 18066772232742525358, 14280452627721849909, 21961317197712048474, 31775251073883498924, 5711364738900902074, 22751297231811709593
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
