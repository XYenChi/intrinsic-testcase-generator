/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    int data1[] = {
    112, 234, 113, 95, 172, 63, 246, 98, 43, 26, 21, 148, 226, 164, 248, 68, 88, 7, 121, 41, 252, 224, 189, 54, 86, 116, 42, 207, 30, 189, 165, 219, 134, 125, 110, 4, 28, 232, 192, 92, 44, 155, 219, 163, 89, 111, 29, 103, 156, 204, 47, 111, 109, 184, 66, 124, 197, 248, 100, 19, 88, 242, 192, 239
    };
    const int *in1 = &data1[0];
    int data2[] = {
    237, 254, 100, 87, 69, 215, 45, 176, 247, 26, 64, 196, 140, 177, 157, 135, 168, 21, 229, 241, 127, 82, 231, 86, 51, 102, 137, 106, 56, 185, 197, 206, 234, 149, 105, 87, 184, 106, 86, 178, 155, 217, 28, 68, 68, 246, 114, 6, 188, 228, 213, 213, 79, 7, 239, 49, 187, 252, 82, 180, 24, 194, 150, 71
    };
    const int *in2 = &data2[0];
    int out_data[64];
    int *out = &out_data[0];
    int masked[] = {
    0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0
    };
    const int *mask = &masked[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint64m1_t out = __riscv_vsub_vv_i64m1_m (mask, data1, data2, 64);
        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
        mask += Q_element;
      }
   int golden[] = {
   -125, -20, 13, 8, 103, -152, 201, -78, -204, 0, -43, -48, 86, -13, 91, -67, -80, -14, -108, -200, 125, 142, -42, -32, 35, 14, -95, 101, -26, 4, -32, 13, -100, -24, 5, -83, -156, 126, 106, -86, -111, -62, 191, 95, 21, -135, -85, 97, -32, -24, -166, -102, 30, 177, -173, 75, 10, -4, 18, -161, 64, 48, 42, 168
   };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden0[i] != out0_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden0[i], out0[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
