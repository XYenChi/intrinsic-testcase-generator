/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    5084928705805635542, 16028405429864320252, 10051828594338941970, 7276411608623941636, 10644713996038042887, 10128475919035305277, 14163908395225270141, 1958024844167640159, 15796028597057137193, 3759784641504403448, 14985625888894348687, 16693060306368621056, 4556306360126364632, 2006258156835926685, 3756075479728656747, 11010690046287012602
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    10117523358345498272, 8796590513146942133, 18063365824778139003, 5526730385606340440, 451080684842174946, 12712737569767312864, 3731851526545268819, 1816542590539779503, 4428386901865106683, 3224138216826505861, 14874009452230920635, 10602892417587276985, 1912042835071385859, 4349518542810542648, 13498744896197812920, 7370767148339226240
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m4(size_t avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m4_t data1_v = __riscv_vle64_v_i64m4 (*in1, vl);
    vint64m4_t data2_v = __riscv_vle64_v_i64m4 (*in2, vl);
    vint64m4_t out_v = __riscv_vle64_v_i64m4 (*out, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmul_vx_i64m4 (data1_v, data2_v, vl);
        void vint64m4_t __riscv_vse64_v_i64 (int64m4_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    51446884956510061885319033483622783424, 140995319145217414488390014394423977516, 181569857107509724133943029028610655910, 40214765135560648894541958426106559840, 4801624879281925110288077690304909102, 128760656340403637497691863822209183328, 52857603166568773092541753454739033479, 3556835522765533125864333063707860977, 69950926140694483398214352411512160819, 12122065349711690931280142075080608728, 222896341119010934445957711970713456245, 176994722548722999128556272424375196160, 8711852930269801032597795607802538888, 8726257054822764967173484586793761880, 50702304711720956986887739710801771240, 81157232473718026850090968341809076480
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
