/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    4324791768774791839, -3712978132444807357, -4907032620955346747, -7440397076286885878, 2544045310642329597, -8279746333210191748, 7022581920201892258, 4897224742067151351, -440633163536913369, 6641641231301684141, 4823992300276080357, -489278483925807068, 8140668156220555236, 7755638473322228888, 122230805890321146, -2613471432441994899
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    2775975573843833830, -5343305824986451744, 5516247478366150966, -7097022002618521220, -7621088758252373171, 7709730857820323792, -387035704874096468, 4124736247172462066, -8694240763400829301, -2076052821613345415, -8446283749178561903, 5778589217127951590, 5325799091580568219, 1050339954549334484, -4209369854044343393, -1007302073991664162
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m2(avl);
    bool32_t masked[] = {
    0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1
    };
    const bool32_t *mask = &masked[0];
    vint64m2_t data1_v = __riscv_vle64_v_i64m2 (in1, vl);
    vint64m2_t data2_v = __riscv_vle64_v_i64m2 (in2, vl);
    vint64m2_t out_v = __riscv_vle64_v_i64m2 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_i64m2 (int64_t *out, vint64m2_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    7100767342618625669, -9056283957431259101, 609214857410804219, -14537419078905407098, -5077043447610043574, -570015475389867956, 6635546215327795790, 9021960989239613418, -9134873926937742669, 4565588409688338727, -3622291448902481546, 5289310733202144523, 13466467247801123455, 8805978427871563372, -4087139048154022247, -3620773506433659060
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
