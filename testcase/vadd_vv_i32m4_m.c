/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint32m4_t data1[] = {
    89, 90, 49, 241, 94, 56, 208, 104, 89, 155, 141, 183, 234, 157, 13, 151, 69, 91, 238, 229, 144, 233, 203, 230, 253, 134, 117, 69, 122, 113, 10, 179, 246, 89, 94, 77, 217, 115, 216, 41, 175, 90, 156, 157, 224, 202, 194, 219, 8, 227, 145, 187, 164, 68, 12, 199, 55, 110, 247, 180, 170, 169, 229, 112
    };
    const vint32m4_t *in1 = &data1[0];
    vint32m4_t data2[] = {
    254, 35, 241, 255, 30, 252, 199, 7, 143, 135, 169, 123, 241, 137, 20, 224, 119, 45, 91, 63, 64, 202, 225, 193, 94, 182, 149, 72, 200, 127, 7, 222, 223, 156, 158, 11, 44, 17, 251, 150, 20, 210, 168, 196, 250, 114, 4, 247, 24, 37, 131, 130, 170, 13, 147, 3, 34, 163, 150, 242, 66, 35, 48, 43
    };
    const vint32m4_t *in2 = &data2[0];
    vint32m4_t out_data[] = {
    187, 206, 44, 76, 129, 244, 198, 241, 117, 254, 151, 148, 183, 80, 225, 171, 93, 50, 96, 254, 197, 253, 97, 177, 232, 249, 76, 254, 56, 169, 114, 184, 53, 236, 105, 135, 33, 184, 249, 115, 180, 247, 54, 85, 245, 142, 78, 58, 133, 60, 0, 60, 27, 234, 20, 102, 126, 220, 224, 140, 155, 175, 128, 105
    };
    vint32m4_t *out = &out_data[0];
    int masked[] = {
    1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1
    };
    const int *mask = &masked[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint32m4_t out = __riscv_vadd_vv_i32m4_m (, mask, data1, data264);
)        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
        mask += Q_element;
      }
    vint32m4_t golden[] = {
    343, 125, 44, 76, 124, 244, 407, 241, 117, 254, 310, 148, 183, 80, 33, 375, 188, 50, 329, 254, 208, 435, 428, 423, 232, 316, 266, 141, 322, 169, 17, 401, 53, 236, 252, 88, 33, 132, 467, 191, 195, 247, 324, 85, 245, 316, 78, 466, 133, 264, 276, 60, 334, 81, 159, 102, 89, 273, 397, 140, 236, 175, 128, 155
    };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
