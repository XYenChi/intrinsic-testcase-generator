/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    11171109751276487252, 5128076802652909737, 15726711017884569274, 13015464185454813762, 2056713802553813257, 10329998026701827205, 3783849058024457861, 8138785849894723751, 5712084936632825611, 14941225223186921602, 1502831974370469906, 7461510131295751207, 1659398781647253375, 11550045375742491554, 17104181833876754523, 6343028251997906546
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    4651880772415297259, 14363749199732070529, 210255253423335687, 3103218258274369182, 14807289352129949592, 16066984805021074186, 15453586555984806133, 8082375462029946274, 12017997468400544703, 4605195594437532883, 15694556724886659348, 961472677795881272, 9406256192709703474, 1938057800724062674, 15285419485912674924, 6952242508852994063
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m8(size_t avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m8_t data1_v = __riscv_vle64_v_i64m8 (*in1, vl);
    vint64m8_t data2_v = __riscv_vle64_v_i64m8 (*in2, vl);
    vint64m8_t out_v = __riscv_vle64_v_i64m8 (*out, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmul_vv_i64m8 (data1_v, data2_v, vl);
        void vint64m8_t __riscv_vse64_v_i64 (int64m8_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    51966670658504124762975215450904042268, 73658409070270327207523794897554840873, 3306623610580885650507529742307881238, 40389826100219518362141600145842282684, 30454356388933778566875176054791341144, 165971921330915938268264967298058030130, 58474038932962534620602417820512861513, 65780723043905656839439268230601753774, 68647822307742184003137921902408788533, 68807264573319355347407113844418038566, 23586281669730754148800821501307581288, 7174038126338023566056820617822695304, 15608730066044414098473071162795724750, 22384655539174623287245264370011655396, 261444594294133334529741728214645681252, 44098270648395347256508139540166836398
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
