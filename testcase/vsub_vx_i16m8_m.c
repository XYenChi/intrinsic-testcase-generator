/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    int data1[] = {
    35, 236, 70, 40, 83, 126, 22, 42, 191, 124, 19, 205, 149, 100, 204, 187, 205, 94, 45, 206, 42, 77, 90, 175, 187, 69, 50, 38, 61, 216, 207, 164, 222, 66, 211, 46, 74, 58, 208, 158, 42, 17, 249, 100, 127, 44, 175, 75, 166, 14, 93, 213, 22, 86, 24, 248, 50, 234, 157, 99, 122, 203, 56, 131
    };
    const int *in1 = &data1[0];
    int data2[] = {
    140, 154, 177, 42, 129, 203, 169, 185, 231, 130, 58, 108, 131, 245, 209, 142, 254, 43, 79, 78, 205, 147, 70, 229, 62, 103, 5, 34, 150, 33, 162, 211, 32, 41, 14, 187, 176, 213, 19, 206, 162, 142, 154, 158, 24, 155, 235, 106, 97, 79, 124, 15, 34, 110, 207, 101, 245, 90, 60, 29, 185, 182, 53, 217
    };
    const int *in2 = &data2[0];
    int out_data[64];
    int *out = &out_data[0];
    int masked[] = {
    1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0
    };
    const int *mask = &masked[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint16m8_t out = __riscv_vsub_vx_i16m8_m (mask, data1, data2, 64);
        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
        mask += Q_element;
      }
   int golden[] = {
   -105, 82, -107, -2, -46, -77, -147, -143, -40, -6, -39, 97, 18, -145, -5, 45, -49, 51, -34, 128, -163, -70, 20, -54, 125, -34, 45, 4, -89, 183, 45, -47, 190, 25, 197, -141, -102, -155, 189, -48, -120, -125, 95, -58, 103, -111, -60, -31, 69, -65, -31, 198, -12, -24, -183, 147, -195, 144, 97, 70, -63, 21, 3, -86
   };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden0[i] != out0_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden0[i], out0[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
