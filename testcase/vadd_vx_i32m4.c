/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint32m4_t data1[] = {
    77, 146, 101, 198, 6, 6, 9, 175, 175, 34, 151, 100, 253, 23, 237, 150, 242, 181, 32, 93, 202, 234, 16, 223, 25, 146, 218, 117, 74, 92, 17, 15, 252, 166, 209, 231, 46, 82, 219, 161, 254, 226, 165, 1, 217, 159, 163, 116, 104, 98, 12, 219, 77, 210, 129, 65, 246, 98, 195, 84, 7, 52, 61, 103
    };
    const vint32m4_t *in1 = &data1[0];
    vint32m4_t data2[] = {
    31, 243, 164, 118, 210, 167, 247, 142, 234, 106, 226, 0, 70, 98, 252, 160, 77, 212, 16, 50, 88, 99, 169, 226, 179, 226, 186, 196, 206, 245, 0, 189, 194, 153, 87, 161, 116, 190, 233, 162, 146, 233, 21, 140, 170, 235, 143, 213, 144, 105, 75, 0, 249, 217, 250, 32, 188, 187, 125, 193, 62, 72, 215, 109
    };
    const vint32m4_t *in2 = &data2[0];
    vint32m4_t out_data[64];
    vint32m4_t *out = &out_data[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint32m4_t out = __riscv_vadd_vx_i32m4 (data1, data2, 64);
)        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
      }
    vint32m4_t golden[] = {
    108, 389, 265, 316, 216, 173, 256, 317, 409, 140, 377, 100, 323, 121, 489, 310, 319, 393, 48, 143, 290, 333, 185, 449, 204, 372, 404, 313, 280, 337, 17, 204, 446, 319, 296, 392, 162, 272, 452, 323, 400, 459, 186, 141, 387, 394, 306, 329, 248, 203, 87, 219, 326, 427, 379, 97, 434, 285, 320, 277, 69, 124, 276, 212
    };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
