/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint8mf4_t data1[] = {
    156, 167, 39, 189, 252, 194, 86, 204, 98, 165, 26, 3, 203, 72, 188, 2, 32, 181, 206, 75, 7, 137, 30, 48, 106, 123, 46, 63, 240, 87, 233, 19, 131, 199, 39, 209, 54, 152, 108, 138, 177, 76, 137, 217, 101, 113, 231, 104, 153, 254, 106, 214, 19, 147, 26, 91, 11, 2, 183, 184, 33, 186, 216, 159
    };
    const vint8mf4_t *in1 = &data1[0];
    vint8mf4_t data2[] = {
    59, 88, 215, 86, 238, 78, 192, 173, 123, 232, 61, 97, 204, 47, 172, 28, 11, 46, 63, 255, 79, 172, 5, 211, 140, 250, 93, 229, 216, 77, 186, 154, 229, 59, 221, 225, 237, 69, 87, 36, 75, 103, 204, 13, 110, 127, 46, 179, 2, 92, 190, 137, 171, 61, 229, 84, 140, 53, 18, 152, 56, 228, 26, 165
    };
    const vint8mf4_t *in2 = &data2[0];
    vint8mf4_t out_data[] = {
    57, 68, 31, 163, 120, 166, 188, 195, 111, 198, 144, 57, 165, 233, 182, 247, 231, 162, 48, 45, 247, 69, 91, 223, 161, 112, 82, 34, 170, 118, 96, 50, 0, 104, 35, 131, 20, 108, 237, 76, 136, 7, 216, 191, 14, 123, 84, 15, 226, 25, 239, 230, 158, 83, 203, 53, 84, 16, 146, 67, 234, 113, 56, 195
    };
    vint8mf4_t *out = &out_data[0];
    int masked[] = {
    1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0
    };
    const int *mask = &masked[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint8mf4_t out = __riscv_vadd_vx_i8mf4_m (, mask, data1, data264);
        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
        mask += Q_element;
      }
    vint8mf4_t golden[] = {
    215, 255, 31, 163, 120, 272, 188, 377, 221, 397, 144, 57, 165, 233, 182, 247, 231, 162, 48, 330, 86, 69, 35, 223, 161, 373, 82, 34, 170, 164, 419, 50, 0, 258, 260, 131, 20, 221, 195, 174, 136, 7, 216, 230, 211, 123, 277, 15, 226, 346, 296, 351, 190, 208, 255, 175, 151, 55, 201, 336, 89, 113, 242, 195
    };
    int fail = 0;
    for (int i = 0; i < 64; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
