/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    9865390961313511674, 7321849989860183278, 2890598328729972022, 15265623190092361873, 2733311327447394292, 2110652509014567535, 7707517079970069931, 7117502496635235910, 853255303151705128, 6209632792203903324, 8778646681184504574, 4361009711678771550, 18443566736150897506, 5393767382458391501, 10173131451597883863, 11325128844732273873
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    2493796298061160537, 18132501248051825561, 11986311314051157090, 17146728406365997370, 1871480624635103641, 6213076604093910613, 4739675995166522608, 6932106693327377654, 15844324655759662329, 7405573531918906340, 9471665686058141106, 10335026316248673128, 15617261063055015220, 13974016385775352442, 14799359721889555858, 9975281954031007438
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m2(size_t avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m2_t data1_v = __riscv_vle64_v_i64m2 (*in1, vl);
    vint64m2_t data2_v = __riscv_vle64_v_i64m2 (*in2, vl);
    vint64m2_t out_v = __riscv_vle64_v_i64m2 (*out, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmul_vv_i64m2 (data1_v, data2_v, vl);
        void vint64m2_t __riscv_vse64_v_i64 (int64m2_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    24602275458249669238909863451337608938, 132763454079188019617126079253945168958, 34647611452033429497058745672426935980, 261755494794436217030385278940606274010, 5115339190413453772814581558811817172, 13113645723130521317837997203141748955, 36531133686270111615793166951852500048, 49339286696699440101032532055952355140, 13519254037384246675684156197857723112, 45985892248880920552925386381170674160, 83148406540203454035693144249994418844, 45071150135616142434043648052535908400, 288037996652346082994531632457490041320, 75372593783534195127287805698692395442, 150555831850265552207891023273735319454, 112971353391933882757217635450716067374
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
