/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint8m8_t data1[] = {
    92, 178, 249, 75, 142, 131, 152, 232, 34, 24, 189, 1, 253, 159, 238, 38, 52, 78, 11, 71, 187, 111, 95, 59, 76, 146, 173, 20, 237, 119, 62, 132, 23, 34, 238, 225, 255, 179, 90, 195, 11, 31, 134, 52, 7, 111, 152, 45, 65, 154, 225, 34, 216, 93, 118, 193, 3, 116, 209, 123, 166, 61, 214, 189, 98, 25, 68, 107, 165, 75, 199, 48, 75, 232, 212, 172, 86, 171, 188, 131, 14, 15, 209, 66, 114, 228, 0, 196, 101, 132, 240, 168, 22, 179, 87, 145, 142, 21, 25, 30, 10, 17, 85, 129, 13, 55, 235, 69, 193, 77, 102, 134, 53, 37, 201, 53, 215, 43, 48, 54, 143, 64, 139, 219, 107, 213, 195, 172
    };
    const vint8m8_t *in1 = &data1[0];
    vint8m8_t data2[] = {
    28, 246, 170, 39, 49, 254, 5, 183, 5, 67, 194, 134, 18, 222, 246, 135, 94, 25, 54, 128, 90, 100, 222, 84, 153, 164, 167, 58, 158, 23, 12, 157, 137, 12, 17, 60, 228, 33, 80, 247, 53, 162, 99, 91, 120, 205, 237, 217, 211, 183, 85, 14, 170, 172, 19, 15, 182, 135, 21, 0, 209, 28, 66, 10, 123, 129, 94, 113, 27, 242, 221, 145, 189, 55, 102, 17, 252, 9, 12, 117, 51, 221, 72, 47, 34, 33, 247, 249, 27, 35, 247, 27, 213, 226, 113, 248, 223, 242, 113, 79, 41, 22, 126, 236, 85, 185, 104, 8, 241, 168, 33, 174, 103, 107, 200, 48, 84, 243, 31, 1, 37, 152, 15, 176, 16, 157, 35, 141
    };
    const vint8m8_t *in2 = &data2[0];
    vint8m8_t out_data[64];
    vint8m8_t *out = &out_data[0];
    for (int n = 128, Q_element = 8;n >= 0; n -= Q_element) {
        vint8m8_t out = __riscv_vadd_vv_i8m8 (data1, data2, 64);
        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
      }
    vint8m8_t golden[] = {
    120, 424, 419, 114, 191, 385, 157, 415, 39, 91, 383, 135, 271, 381, 484, 173, 146, 103, 65, 199, 277, 211, 317, 143, 229, 310, 340, 78, 395, 142, 74, 289, 160, 46, 255, 285, 483, 212, 170, 442, 64, 193, 233, 143, 127, 316, 389, 262, 276, 337, 310, 48, 386, 265, 137, 208, 185, 251, 230, 123, 375, 89, 280, 199, 221, 154, 162, 220, 192, 317, 420, 193, 264, 287, 314, 189, 338, 180, 200, 248, 65, 236, 281, 113, 148, 261, 247, 445, 128, 167, 487, 195, 235, 405, 200, 393, 365, 263, 138, 109, 51, 39, 211, 365, 98, 240, 339, 77, 434, 245, 135, 308, 156, 144, 401, 101, 299, 286, 79, 55, 180, 216, 154, 395, 123, 370, 230, 313
    };
    int fail = 0;
    for (int i = 0; i < 128; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
