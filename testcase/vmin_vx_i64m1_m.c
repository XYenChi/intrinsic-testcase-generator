/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    8895637686274124760, 2137066102466764243, 16683820108368546326, 8632761357043839710, 10855919505012506829, 13319298140065851627, 18032598076786274374, 5993087570575498530, 5793943207960299434, 10272530566581117778, 8874984065570052575, 12249890332793536078, 4133233232922340243, 2339950513578029082, 4186389909240986979, 13042276667284417782
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    1053752324512323932, 14225311091903211056, 8424933587913091883, 5971239508193709763, 6016524599722137442, 14218260820886552281, 9943843461200437158, 8907425263434660479, 16797183310893043544, 8237951191075876519, 11540060605528433730, 1232888843727578416, 2716118072345434623, 1198704518609700547, 3860483792912946152, 13016553027388357886
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m1(size_t avl);
    const int out_data[] = {
    8938865530429449184, 7196160638141059580, 18272192382046515776, 8961926020560048536, 4625895342447290197, 6151426563591935625, 413607223632276130, 16483402231507703032, 10911058541915156082, 10513305620497354199, 1994915073083408620, 8687107587137450650, 18025146838772195691, 8075881577977168870, 15313752811594303825, 12507089252408128932
    };
    const int64_t *out = &out_data[0];
    bool64_t masked[] = {
    0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0
    };
    const bool64_t *mask = &masked[0];
    vint64m1_t data1_v = __riscv_vle64_v_i64m1_m (mask, *in1, vl);
    vint64m1_t data2_v = __riscv_vle64_v_i64m1_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmin_vx_i64m1_m (mask, data1_v, data2_v, vl);
        void vint64_t __riscv_vse64m1_v_i64 (vbool64_t mask, int64m1_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    8938865530429449184, 14225311091903211056, 18272192382046515776, 8632761357043839710, 4625895342447290197, 14218260820886552281, 18032598076786274374, 8907425263434660479, 10911058541915156082, 10272530566581117778, 1994915073083408620, 8687107587137450650, 4133233232922340243, 2339950513578029082, 4186389909240986979, 12507089252408128932
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
