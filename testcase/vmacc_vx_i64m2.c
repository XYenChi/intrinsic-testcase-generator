/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    6656778115937177086, 3940847380110074609, 15141994029166396731, 18223599284174949480, 16972693231984159271, 11814470879930152564, 16316653086315165028, 14440209981018161291, 17034340406067414233, 12069765382436220289, 16011722909560310286, 14001928277104047999, 16825916607341921444, 8621454913976768430, 6933983716660782646, 8910686260313329613
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    5285115769782525094, 2097319613724107105, 813398876129253166, 1696305892074747365, 17190718319167860486, 4917693209918952846, 4323812460491377895, 3027463052085250553, 17036799675150620035, 2066167635580681020, 3948765353374375279, 17443483024610175167, 6372492760405170743, 7946456976998821266, 17315463742799133771, 6119976261460884363
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m2(size_t avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m2_t data1_v = __riscv_vle64_v_i64m2 (*in1, vl);
    vint64m2_t data2_v = __riscv_vle64_v_i64m2 (*in2, vl);
    vint64m2_t out_v = __riscv_vle64_v_i64m2 (*out, vl);
    const int out_data[] = {
    15674219852809588187, 6036503518999556298, 2889086477092386618, 14089582324919418508, 14399887479969868698, 7870779864941807983, 13813711971567244757, 4720372885792824459, 4452261702759771498, 8867820979518435481, 1444660109801191043, 7654443772008368678, 565313260693335501, 16344561751146572337, 16559217258592358975, 542966605847287944
    };
    const int64_t *out = &out_data[0];
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmacc_vx_i64m2 (data1_v, data2_v, vl);
        void vint64m2_t __riscv_vse64_v_i64 (int64m2_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    35181842996482780767149171384126384271, 8265216504998121170043850542456553243, 12316480925679808988677413951386186964, 30912798840555115203123882157557538708, 291772788468686448046843044648501334404, 58099943225017707305283455720843805127, 70550147928124608695835159949603500817, 43717202181885140540517410770893768382, 290210645096494403785480824121893729653, 24938158602241799495163721976879650261, 63226536673102498954268313998449010837, 244242398213473658084696097512174209511, 107223031767467526380396824267206448393, 68510020553051463920794826368988004717, 120065143638999363792262765354301697041, 54533188386443239614948644697943829463
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
