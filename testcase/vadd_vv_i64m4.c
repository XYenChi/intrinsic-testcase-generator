/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    -2206947425916101061, 5789803151001357747, 456757312060715171, 2074506683455827372, 9205859352292026053, -7173791413703787667, -9149701726134577655, -7460721526461074593, 3662327752138224061, 7298036789941350548, -1673381933962904132, 3661256190123588745, -4440459245578414463, 2383762462695048236, 1444523522150455339, 8984676376447494146
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    6256328467111840677, 5830709767219364, -4167125967213123844, -2919476933165361820, -5821082204031992240, -251621833367460444, 6886866389417410863, -4005208215636096327, 5575506416816924628, -1504342310157136395, 2535451064969503869, 6886380997920108106, -2816941944333949376, -2741371585359555218, -8633887647963033884, -4321422882439712723
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m4(avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m4_t data1_v = __riscv_vle64_v_i64m4 (in1, vl);
    vint64m4_t data2_v = __riscv_vle64_v_i64m4 (in2, vl);
    vint64m4_t out_v = __riscv_vle64_v_i64m4 (out, vl);
    for (size_t n = 0; n < vl; n++) {
		out = __riscv_vadd_vv_i64m4(op1, op2, vl);
        void __riscv_vse64_v_i64m4 (int64_t *out, vint64m4_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    4049381041195739616, 5795633860768577111, 14736375418557142943, 17601773824000017168, 3384777148260033813, 11021330826638303505, 16183908736992384824, 6980814331612380696, 9237834168955148689, 5793694479784214153, 862069131006599737, 10547637188043696851, 11189342883797187777, 18089134951045044634, 11257379947896973071, 4663253494007781423
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    6334141221651869262, 4753319972296914053, 8748477158107462756, -1203476895407808476, -3803756297088852036, -3014051006706162776, 4762989809133640260, 8645347479929743276, -4837391614081303116, 5439527163719411588, -6190701399713026035, 7032756995874449267, -7445724562264879551, 7529792070552614494, -6398198814103994345, 5878945422086655982
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    -866318738310801109, -8607006456455601919, -5136885492326848247, 2275539252517787815, 7940745293204098190, 3083045336109933392, -6113145665900717424, 7313788985646551813, 9222286956022874511, -8588930601079850916, 8765383219234584482, -5647755151731721574, 2487824276986030610, -5490521485544445421, 2701041715157401840, 8596886621708971564
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m4(avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m4_t data1_v = __riscv_vle64_v_i64m4 (in1, vl);
    vint64m4_t data2_v = __riscv_vle64_v_i64m4 (in2, vl);
    vint64m4_t out_v = __riscv_vle64_v_i64m4 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_i64m4 (int64_t *out, vint64m4_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    5467822483341068153, 14593057589550863750, 3611591665780614509, 1072062357109979339, 4136988996115246154, 68994329403770616, 17096588216942474452, 15959136465576295089, 4384895341941571395, 15297340636349112288, 2574681819521558447, 1385001844142727693, 13488843788430702675, 2039270585008169073, 14749586974762959111, 14475832043795627546
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
