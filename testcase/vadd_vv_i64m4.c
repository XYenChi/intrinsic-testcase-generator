/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    -7545788774964510102, -8510334502639144289, 5132268189526358324, -5243385359941561648, -717467033899882184, 5542628390762297441, -6383272825534885086, -4038015739565010182, -5835712709944769999, 8637536433882075305, 4469642243835145474, 6938762535797716763, 7893558132502168552, 1820529575655251182, -9064592749246827384, 792582837535644866
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    -1829400093755122742, -2545262558218522953, 5942156872619520312, 3921473808545856667, -3637098288850213136, 1602606377048585566, -1179026775802722567, 2729059000281605467, -4286304878489929778, -5970317003995206737, 6449330514241736978, 4890896102140958325, -2102456726151156677, -276401514999108997, 8321240151341042278, 747141621956929472
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m4(avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m4_t data1_v = __riscv_vle64_v_i64m4 (*in1, vl);
    vint64m4_t data2_v = __riscv_vle64_v_i64m4 (*in2, vl);
    vint64m4_t out_v = __riscv_vle64_v_i64m4 (*out, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vadd_vv_i64m4 (data1_v, data2_v, vl);
        void __riscv_vse64_v_i64m4 (int64_t *out, vint64m4_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    -6256192253934570102, -6072582491376275133, -724955394175370329, -2167200158833316747, -4010573065391342926, 14623334751856271934, -3369557401660096241, -4201906351984749995, -12194030134474519719, 15260015242573287497, 767610836249603563, -1706395957390021387, 9009824421650281501, -6204914800769833581, -18185366907203283546, -4542732090779627471
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
