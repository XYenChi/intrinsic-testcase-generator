/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    int data1[] = {
    57, 55, 136, 80, 109, 64, 168, 29, 52, 71, 253, 20, 228, 32, 0, 67, 149, 243, 129, 202, 113, 19, 145, 192, 125, 228, 17, 183, 18, 151, 29, 50, 226, 6, 145, 129, 33, 73, 187, 42, 81, 100, 133, 59, 113, 134, 51, 37, 225, 23, 247, 237, 207, 6, 210, 96, 225, 228, 24, 214, 93, 3, 33, 36
    };
    const int *in1 = &data1[0];
    int data2[] = {
    113, 168, 244, 221, 72, 112, 89, 147, 219, 72, 190, 199, 146, 80, 149, 171, 2, 203, 177, 184, 209, 248, 114, 101, 23, 207, 90, 224, 189, 111, 142, 217, 32, 178, 74, 51, 144, 28, 221, 80, 119, 253, 60, 147, 179, 13, 138, 31, 131, 246, 37, 163, 179, 30, 86, 14, 152, 251, 52, 113, 21, 115, 102, 135
    };
    const int *in2 = &data2[0];
    int out_data[64];
    int *out = &out_data[0];
    int masked[] = {
    1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1
    };
    const int *mask = &masked[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint8mf4_t out = __riscv_vsub_vx_i8mf4_m (mask, data1, data2, 64);
        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
        mask += Q_element;
      }
   int golden[] = {
   -56, -113, -108, -141, 37, -48, 79, -118, -167, -1, 63, -179, 82, -48, -149, -104, 147, 40, -48, 18, -96, -229, 31, 91, 102, 21, -73, -41, -171, 40, -113, -167, 194, -172, 71, 78, -111, 45, -34, -38, -38, -153, 73, -88, -66, 121, -87, 6, 94, -223, 210, 74, 28, -24, 124, 82, 73, -23, -28, 101, 72, -112, -69, -99
   };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden0[i] != out0_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden0[i], out0[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
