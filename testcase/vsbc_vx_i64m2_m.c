/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    17292064352677273178, 3329900542498211920, 679061008732814898, 4953919354312781192, 2964118829839928935, 14507657324001197576, 4389338026387995799, 3903005375149895265, 756046267229981928, 11551989457858614427, 5249778362499091172, 10263999393251912564, 2368098850122035192, 10400805606071119389, 10678897598013648557, 2472824659321149075
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    1194511120136925271, 8360497413408367787, 4045746491931619821, 10118178299705164654, 13150582309648362656, 2940304578769536568, 9120140543930112557, 9953495489901660923, 12703020060953078982, 6214145876303794661, 3589449271920608208, 13121837050841635804, 9887793922918334778, 14375307741812399244, 15544616227268021428, 3109335654077604995
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m2(size_t avl);
    const int out_data[] = {
    13111034665420298449, 10437444304526795055, 12674283620724079465, 11588586311536962670, 4056338707870428838, 10339652644869075797, 902101638970965329, 1698680440101929415, 15711704475352661667, 13059916760028726502, 8350882177871995696, 10788295972860314038, 17762139240230233180, 17923258492946340491, 4934101781027124869, 17566180263403797896
    };
    const int64_t *out = &out_data[0];
    bool32_t masked[] = {
    0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0
    };
    const bool32_t *mask = &masked[0];
    vint64m2_t data1_v = __riscv_vle64_v_i64m2_m (mask, *in1, vl);
    vint64m2_t data2_v = __riscv_vle64_v_i64m2_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vsbc_vx_i64m2_m (mask, data1_v, data2_v, vl);
        void vint32_t __riscv_vse64m2_v_i64 (vbool64_t mask, int64m2_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    16097553232540347907, -5030596870910155868, -3366685483198804924, -5164258945392383463, -10186463479808433721, 11567352745231661007, -4730802517542116758, -6050490114751765658, -11946973793723097054, 5337843581554819766, 1660329090578482963, -2857837657589723240, -7519695072796299586, -3974502135741279856, -4865718629254372871, -636510994756455920
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
