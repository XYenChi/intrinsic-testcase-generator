/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    5938782655299106310, 4516500575690201953, -7269637015107807188, -7150243076058202216, -1708880285092616936, 3596267391722031570, 9211505484800697514, 2827837590972403228, -3829309857903279168, 4073992899146536504, -4495571895696334958, -4689497104655476078, -517442087681270877, -2423622922848077061, -1063727300691258999, 952379337855192190
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    4306709655289213634, -5464164544346091159, -4937279442935103273, 5927586346683695263, -7393129428209491811, -1838474613729960551, 2385332185376875872, -622066503616334305, -1301439099378203217, -6728208249102610709, -1551989204447528550, 5796540596090395679, 7375989589005690468, -1521679664868743411, -6022880720802439997, -8003931012495770889
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m2(avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m2_t data1_v = __riscv_vle64_v_i64m2 (in1, vl);
    vint64m2_t data2_v = __riscv_vle64_v_i64m2 (in2, vl);
    vint64m2_t out_v = __riscv_vle64_v_i64m2 (out, vl);
    for (size_t n = 0; n < vl; n++) {
		out = __riscv_vadd_vx_i64m2(op1, op2, vl);
        void __riscv_vse64_v_i64m2 (int64_t *out, vint64m2_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    10245492310588319944, 17499080105053662410, 6239827615666641155, 17224087344335044663, 9344734360407442869, 1757792777992071019, 11596837670177573386, 2205771087356068923, 13315995116428069231, 15792528723753477411, 12399182973565688108, 1107043491434919601, 6858547501324419591, 14501441485992731144, 11360136052215852620, 11395192399068972917
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    3573826897347902023, -7250206223974866289, 8462159815430314276, -709728184011905374, 700364071292125279, -909696624854725594, -1042637346152722642, 4795766520299818075, -1176293751635492576, -6529606697938758556, -5519114981637818631, 6426475846092359329, 6947677597499265176, 3927134537077686747, -601262251518854959, 4580155546890502530
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    1351249456707820301, 8410661202913798478, 1381492943157067153, 7643286809474219863, 4111394663008615075, -1759276902570332754, 2669102923435696790, 7433258277335095764, 288026505448521591, 2091627360449757218, 4481552963764249817, -831891953251698798, 2191645501865682707, -8508738901804665551, -7739272519790488922, 63348059300021987
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m2(avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m2_t data1_v = __riscv_vle64_v_i64m2 (in1, vl);
    vint64m2_t data2_v = __riscv_vle64_v_i64m2 (in2, vl);
    vint64m2_t out_v = __riscv_vle64_v_i64m2 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_i64m2 (int64_t *out, vint64m2_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    4925076354055722324, 1160454978938932189, 9843652758587381429, 6933558625462314489, 4811758734300740354, 15777770546284493268, 1626465577282974148, 12229024797634913839, 17558476827522580631, 14008764736220550278, 17409182055835982802, 5594583892840660531, 9139323099364947883, 13865139708982572812, 10106209302400207735, 4643503606190524517
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
