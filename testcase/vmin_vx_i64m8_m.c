/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    1205551506900826730, 12155343603967082805, 17016795104054965175, 14794921427358464177, 17880525263361522642, 2790893612809342874, 7254987314818459966, 3942957007496860783, 1782133972165508977, 5476265711700839868, 17616034120165864126, 5091094716028205699, 1700727587810477565, 4898539267060585942, 2929648230688546449, 18050551932445126989
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    16429730037714091512, 2456441618791891979, 16466179741363601785, 8163270946757990953, 3204145196958203597, 8627877209665264191, 16833341739484477575, 9128848908194416525, 4786121226580994388, 11431424647690155590, 11297175259689573189, 2041042254050583203, 16531474045536897120, 15032207947582572912, 1389826245225133358, 17789851495073973222
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m8(size_t avl);
    const int out_data[] = {
    11413277791203535667, 6923984357941997209, 11772282750640697564, 16734397942576238664, 9480820042796942411, 7159372426327141613, 3716729013897780646, 4993747005281778611, 15673297596331786273, 17249636322226635082, 2215359504703264279, 12192153805247843716, 6775740752121675540, 16212830475806376541, 11946989036398878781, 9569668476129468336
    };
    const int64_t *out = &out_data[0];
    bool8_t masked[] = {
    0, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0
    };
    const bool8_t *mask = &masked[0];
    vint64m8_t data1_v = __riscv_vle64_v_i64m8_m (mask, *in1, vl);
    vint64m8_t data2_v = __riscv_vle64_v_i64m8_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmin_vx_i64m8_m (mask, data1_v, data2_v, vl);
        void vint8_t __riscv_vse64m8_v_i64 (vbool64_t mask, int64m8_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    11413277791203535667, 6923984357941997209, 17016795104054965175, 14794921427358464177, 17880525263361522642, 8627877209665264191, 16833341739484477575, 4993747005281778611, 15673297596331786273, 11431424647690155590, 17616034120165864126, 5091094716028205699, 6775740752121675540, 16212830475806376541, 11946989036398878781, 9569668476129468336
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
