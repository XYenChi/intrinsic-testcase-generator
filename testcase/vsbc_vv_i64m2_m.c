/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    9960208481698398539, 7509844099993251299, 3928472406531989140, 11414291678165717163, 2868213179185314040, 16155664066325959417, 7537885918264659863, 9530068242061879904, 430450027145411309, 6726747058024176184, 12808891962448938023, 14585044887278737335, 9432019468041863496, 9018998979125609481, 17084585848347910549, 3761141857701396098
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    13999859480556380643, 8457467946003578520, 4905919457857893055, 4391609483388477810, 3209812088389105509, 11783319302861733612, 3837971686840584575, 6461645331414799412, 4844273944512929150, 1102465340816112801, 14978782375334476146, 16223481691417795305, 16531330850228471112, 7570030646211756133, 13072984234150909140, 13085143631515875952
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m2(size_t avl);
    const int out_data[] = {
    8283628694492521544, 12357156236231668671, 17822168962513987125, 11093670410258460504, 4145942942178619547, 1328983381743602357, 5076834300949336071, 5795026193277100244, 17420629113337450052, 4359430282428389094, 11887915414269825965, 6272740298996045290, 9830200665855484832, 1663553622088289550, 7726856866411953467, 15631552541120654447
    };
    const int64_t *out = &out_data[0];
    bool32_t masked[] = {
    1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1
    };
    const bool32_t *mask = &masked[0];
    vint64m2_t data1_v = __riscv_vle64_v_i64m2_m (mask, *in1, vl);
    vint64m2_t data2_v = __riscv_vle64_v_i64m2_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vsbc_vv_i64m2_m (mask, data1_v, data2_v, vl);
        void vint32_t __riscv_vse64m2_v_i64 (vbool64_t mask, int64m2_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    -4039650998857982105, -947623846010327222, -977447051325903916, 7022682194777239352, -341598909203791470, 4372344763464225805, 3699914231424075287, 3068422910647080492, -4413823917367517841, 5624281717208063382, -2169890412885538124, -1638436804139057971, -7099311382186607617, 1448968332913853348, 4011601614197001408, -9324001773814479855
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
