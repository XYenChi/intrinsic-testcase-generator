/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint32mf2_t data1[] = {
    4, 188, 175, 73, 153, 9, 136, 116, 222, 95, 205, 222, 22, 37, 139, 158, 0, 211, 241, 87, 228, 186, 61, 164, 91, 38, 89, 211, 118, 222, 112, 89, 207, 145, 239, 215, 128, 124, 247, 20, 164, 113, 217, 171, 195, 32, 251, 165, 60, 125, 37, 157, 144, 126, 63, 52, 220, 229, 122, 92, 80, 16, 195, 10
    };
    const vint32mf2_t *in1 = &data1[0];
    vint32mf2_t data2[] = {
    111, 208, 143, 238, 168, 165, 121, 168, 34, 240, 92, 112, 10, 72, 240, 54, 82, 33, 121, 47, 254, 198, 218, 39, 47, 155, 192, 62, 74, 196, 222, 31, 62, 65, 62, 248, 135, 165, 83, 133, 122, 172, 9, 234, 236, 113, 176, 54, 250, 209, 117, 234, 34, 213, 217, 8, 108, 146, 171, 253, 93, 106, 136, 232
    };
    const vint32mf2_t *in2 = &data2[0];
    vint32mf2_t out_data[] = {
    251, 164, 130, 37, 118, 181, 173, 153, 53, 54, 56, 87, 187, 125, 2, 1, 232, 55, 33, 83, 164, 194, 201, 9, 6, 57, 236, 25, 76, 27, 174, 245, 10, 19, 81, 179, 122, 159, 108, 31, 98, 37, 207, 181, 157, 153, 66, 105, 7, 110, 232, 112, 164, 173, 53, 215, 11, 199, 193, 67, 101, 236, 238, 246
    };
    vint32mf2_t *out = &out_data[0];
    int masked[] = {
    0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0
    };
    const int *mask = &masked[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint32mf2_t out = __riscv_vadd_vv_i32mf2_m (, mask, data1, data264);
)        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
        mask += Q_element;
      }
    vint32mf2_t golden[] = {
    251, 396, 318, 311, 118, 174, 257, 153, 53, 335, 297, 87, 187, 109, 379, 1, 232, 244, 33, 134, 482, 194, 279, 9, 6, 57, 281, 25, 192, 27, 174, 120, 10, 19, 301, 179, 122, 289, 330, 31, 98, 37, 226, 181, 157, 153, 66, 105, 310, 334, 232, 112, 164, 173, 280, 60, 11, 375, 293, 67, 101, 236, 238, 246
    };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
