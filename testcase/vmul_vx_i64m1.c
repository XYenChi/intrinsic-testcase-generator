/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    9539412045154300856, 9919376452761300260, 2519620674500474794, 7676801165331576663, 499037209357903065, 13146445002009007324, 4560019276796014475, 3740466432850132322, 15343736427712472408, 14197248807330530072, 325600895070571796, 10067051028749670148, 16300246957804948978, 5178458132327219505, 6070232027160855418, 8769496395279745954
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    7619944711911505376, 10242948524898513236, 11293605662624576578, 2661289260003548487, 8834782722197212575, 3343134269935955506, 5321385783026374054, 16427760956394930493, 17574428271903088226, 8496065062342129029, 6979660184927482584, 7392373040143191502, 12888786358995615437, 1257708254521615566, 5103328196273955251, 13584531756307982897
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m1(size_t avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m1_t data1_v = __riscv_vle64_v_i64m1 (*in1, vl);
    vint64m1_t data2_v = __riscv_vle64_v_i64m1 (*in2, vl);
    vint64m1_t out_v = __riscv_vle64_v_i64m1 (*out, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmul_vx_i64m1 (data1_v, data2_v, vl);
        void vint64m1_t __riscv_vse64_v_i64 (int64m1_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    72689792368218433349617272595765401856, 101603662404724407258160573272180241360, 28455602317204517213944242034211774932, 20430188492479650341245303330478158881, 4408885314968715125891129090049042375, 43950330814044573815492897622492125944, 24265621749868519412974467957748431650, 61447488424281223811160673985042694746, 269657395271819370657177080513014668208, 120620749573339376979582946799588660088, 2272583603500820994167337255711600864, 74419396618674842668485320370496682296, 210090400638016205510635336961494173386, 6512989538722532570009459769306814830, 30978386262135203220787856891412899918, 119129502268506092320774828508336948738
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
