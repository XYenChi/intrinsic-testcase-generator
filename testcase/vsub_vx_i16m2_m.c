/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    int data1[] = {
    52, 4, 64, 91, 81, 227, 74, 141, 44, 239, 190, 206, 120, 4, 89, 48, 212, 136, 83, 98, 176, 5, 157, 161, 247, 80, 109, 32, 143, 201, 243, 2, 198, 170, 84, 138, 76, 215, 153, 193, 241, 39, 237, 243, 50, 190, 37, 53, 153, 96, 243, 1, 189, 243, 155, 206, 106, 213, 99, 86, 250, 55, 163, 143
    };
    const int *in1 = &data1[0];
    int data2[] = {
    21, 252, 96, 128, 117, 148, 216, 163, 65, 122, 248, 238, 48, 120, 202, 172, 83, 180, 17, 14, 166, 217, 54, 133, 218, 191, 209, 93, 155, 92, 74, 107, 79, 195, 138, 233, 230, 182, 58, 48, 133, 163, 1, 152, 181, 117, 209, 203, 245, 78, 185, 15, 82, 98, 151, 210, 195, 74, 161, 51, 138, 57, 209, 241
    };
    const int *in2 = &data2[0];
    int out_data[64];
    int *out = &out_data[0];
    int masked[] = {
    1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0
    };
    const int *mask = &masked[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint16m2_t out = __riscv_vsub_vx_i16m2_m (mask, data1, data2, 64);
        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
        mask += Q_element;
      }
   int golden[] = {
   31, -248, -32, -37, -36, 79, -142, -22, -21, 117, -58, -32, 72, -116, -113, -124, 129, -44, 66, 84, 10, -212, 103, 28, 29, -111, -100, -61, -12, 109, 169, -105, 119, -25, -54, -95, -154, 33, 95, 145, 108, -124, 236, 91, -131, 73, -172, -150, -92, 18, 58, -14, 107, 145, 4, -4, -89, 139, -62, 35, 112, -2, -46, -98
   };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden0[i] != out0_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden0[i], out0[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
