/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    16786691930223133039, 6576679132541643210, 9582122172468968740, 9684674955257314312, 2013864967193248663, 11494135493751017314, 18362050386724061026, 18305644275236590686, 2783582607920344280, 13485697884197945131, 2241764777709404058, 4444806217302933258, 132107350076515319, 2182563964847002922, 2479969860881444789, 17267899180180403254
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    9838484877339089970, 17444151766702783319, 5347869608202741474, 14738390708880595867, 6691462545897132379, 8279764033003964264, 6055046686764976429, 1165059631213632306, 1817511315693652372, 16471075594186991575, 9002603745730753830, 16859699035111628811, 6692358030856704813, 1865351835120515063, 8627985944315387117, 8001406086257810963
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m2(size_t avl);
    const int out_data[] = {
    2703039811259291290, 2145219229053124956, 13531481783790497388, 12029701211407930161, 15248032402647668837, 6865118376820359104, 17511876160118677991, 9509928958210444702, 17330903579239980359, 8268622525249468410, 16557737852456496441, 17885177639036585476, 5106053758435903983, 17995728428616615714, 16887855989395174132, 17319720596091611087
    };
    const int64_t *out = &out_data[0];
    bool32_t masked[] = {
    1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0
    };
    const bool32_t *mask = &masked[0];
    vint64m2_t data1_v = __riscv_vle64_v_i64m2_m (mask, *in1, vl);
    vint64m2_t data2_v = __riscv_vle64_v_i64m2_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmul_vx_i64m2_m (mask, data1_v, data2_v, vl);
        void vint32_t __riscv_vse64m2_v_i64 (vbool64_t mask, int64m2_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    165155614696050432502779155478500518830, 114724588908963633859029065780837613990, 13531481783790497388, 142736523379093001743854213800667148504, 15248032402647668837, 95168729651633935201166466744901266896, 17511876160118677991, 21327167168435081781663688429828301916, 17330903579239980359, 8268622525249468410, 20181719984853951691539242852401042140, 17885177639036585476, 884109685219765412170888162055530347, 4071249697095264228528128212506014086, 16887855989395174132, 17319720596091611087
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
