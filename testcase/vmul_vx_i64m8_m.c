/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    15009962318618275930, 12863037378749145217, 9310389748745839968, 10905955807202391940, 11449650311078748502, 14292421567304736739, 14691295739284711625, 3903635506518284138, 9422109139978280190, 6617547337579995647, 8040403655799859902, 16554275716504580196, 15983579340339956001, 14092795886091882644, 2263125248047917112, 17431842943090283435
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    16754912285410015787, 5653986866745470654, 9450348510620693745, 17655662221729722894, 97639396204935048, 5504179614067025300, 11343072443454951133, 13503774632082895396, 13579609948390032227, 8534299229092330052, 871605661574943003, 12654178872072606901, 15184376820624100497, 3382968645333915961, 589333529543495962, 6740002360024312811
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m8(size_t avl);
    const int out_data[] = {
    15798904013626699409, 755053883288736483, 14074977191024716587, 17763040755406886240, 3976783340559058800, 18052940480877743282, 8790005005826937250, 8096848831329429765, 5613049451261018419, 1409771671322733407, 1856425909644075453, 12314972057737297805, 9283332393786826942, 850282714348639911, 8134870445868051486, 18296487366362191756
    };
    const int64_t *out = &out_data[0];
    bool8_t masked[] = {
    0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1
    };
    const bool8_t *mask = &masked[0];
    vint64m8_t data1_v = __riscv_vle64_v_i64m8_m (mask, *in1, vl);
    vint64m8_t data2_v = __riscv_vle64_v_i64m8_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmul_vx_i64m8_m (mask, data1_v, data2_v, vl);
        void vint8_t __riscv_vse64m8_v_i64 (vbool64_t mask, int64m8_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    15798904013626699409, 72727444405903751452807290908857961918, 14074977191024716587, 17763040755406886240, 3976783340559058800, 78668055426410614727715708917352496700, 166644431858927546606564902038372021125, 52713814125819669398044880960860028648, 127948567012065704382958113474135683130, 1409771671322733407, 7008061347743027196787855041035165706, 209480766014256875065527771032337532596, 9283332393786826942, 850282714348639911, 8134870445868051486, 117490662576001673147825944417091585785
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
