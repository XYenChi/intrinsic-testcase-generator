/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    -8668280858436477789, -6088474209201319908, -4937858360513500357, -1791393944968957432, 4042363257786722325, 1842865209453514579, 3240487081580073064, -6328589424646740415, -4364960834038717603, 1641109848064253160, 3179257928024263322, -1578245299463114952, 2542683193230486734, 2931968332849881876, 3644716249673008971, 235706984579094700
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    5312666685165842675, -2064045097114797936, -4889169006500174641, -3845060060358603470, 1960794543469686663, 2807134611316302547, 3716191853948469408, 7535984203256499940, -6259389740848142759, -5173035917261704913, -9069860390402971396, -3876900224756278882, 8027636593287707617, -1652350521182145507, 6746880970600672824, 2236686904605562360
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m2(avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m2_t data1_v = __riscv_vle64_v_i64m2 (in1, vl);
    vint64m2_t data2_v = __riscv_vle64_v_i64m2 (in2, vl);
    vint64m2_t out_v = __riscv_vle64_v_i64m2 (out, vl);
    for (size_t n = 0; n < vl; n++) {
		out = __riscv_vadd_vv_i64m2(op1, op2, vl);
        void __riscv_vse64_v_i64m2 (int64_t *out, vint64m2_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    15091129900438916502, 10294224767393433772, 8619716706695876618, 12810290068381990714, 6003157801256408988, 4649999820769817126, 6956678935528542472, 1207394778609759525, 7822393498822691254, 14914818004512099863, 12556141611330843542, 12991598549490157782, 10570319786518194351, 1279617811667736369, 10391597220273681795, 2472393889184657060
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    2382595266368470589, -3277447870512711405, -4692215540841372, 8916817720478288976, -6784538057091921757, -7805557445250217019, -6462232869892645757, -186460329451937627, 422505175243637330, 5455184419931236715, 701760252865872769, 4538432543522170042, -1654237577382607688, 2356119785267214945, 6576378599956754112, 3656730574233569395
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    -1672274946959514790, 7455809059914759602, 8225673011713620641, 580996944681261689, 8131628265953040837, -4255596071907586282, -6730892130159967868, -4732636295427472517, 3062427008324543063, -1634346559649403744, -497571280184179916, 7475673812305950248, 7141487454617676, -5026138510162391200, -5761106919660991473, -3494857334554051100
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m2(avl);
    const int64_t out_data[16];
    const int64_t *out = &out_data[0];
    vint64m2_t data1_v = __riscv_vle64_v_i64m2 (in1, vl);
    vint64m2_t data2_v = __riscv_vle64_v_i64m2 (in2, vl);
    vint64m2_t out_v = __riscv_vle64_v_i64m2 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_i64m2 (int64_t *out, vint64m2_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
      }
    int64_t golden[] = {
    710320319408955799, 4178361189402048197, 8220980796172779269, 9497814665159550665, 1347090208861119080, 6385590556551748315, 5253619073656937991, 13527647448830141472, 3484932183568180393, 3820837860281832971, 204188972681692853, 12014106355828120290, 16799647983781561604, 15776725348814375361, 815271680295762639, 161873239679518295
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
