/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2 -w" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    2863577964920218763, 9153328053512450492, 17752675740090346043, 12880696379621952183, 6241893528556020293, 13700682979146184356, 15369679000268952533, 4656166040635594962, 11443354435419642614, 13272221890485829637, 1474408847670459756, 3671296356520171375, 8523548800615392372, 10836929968370767022, 10667450616576707284, 1433127960427188743
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    783558835257176400, 18390799525406246884, 12685359589040677067, 14501397957216135745, 805877229302177390, 9128683458683981539, 13411925971242919109, 932199359816279446, 11197207913938478732, 13374647680181040435, 15246746286162623073, 14853231028647440304, 7127495182455547215, 13985121966033542478, 17165288939444438617, 6153345457811267525
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = __riscv_vsetvl_e64m1(avl);
    bool64_t masked[] = {
    0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1
    };
    const bool64_t *mask = &masked[0];
    vuint64m1_t data1_v = __riscv_vle64_v_u64m1 (in1, vl);
    vuint64m1_t data2_v = __riscv_vle64_v_i64m1 (in2, vl);
    vuint64m1_t out_v = __riscv_vle64_v_u64m1 (out, vl);
    for (size_t n = 0; n < vl; n++) {
        void __riscv_vse64_v_u64m1 (uint64_t *out, vuint64m1_t out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    3647136800177395163, 27544127578918697377, 30438035329131023111, 27382094336838087929, 7047770757858197684, 22829366437830165896, 28781604971511871643, 5588365400451874408, 22640562349358121347, 26646869570666870072, 16721155133833082829, 18524527385167611679, 15651043983070939587, 24822051934404309500, 27832739556021145901, 7586473418238456269
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out_data[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
