/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    vint16m1_t data1[] = {
    7, 95, 17, 148, 35, 96, 110, 95, 247, 221, 227, 243, 88, 63, 136, 107, 102, 221, 196, 158, 147, 175, 60, 180, 34, 121, 114, 70, 86, 114, 21, 221, 22, 163, 196, 202, 4, 101, 49, 55, 4, 163, 149, 90, 81, 179, 126, 172, 5, 66, 39, 208, 250, 25, 67, 101, 250, 200, 137, 36, 124, 31, 152, 178
    };
    const vint16m1_t *in1 = &data1[0];
    vint16m1_t data2[] = {
    219, 62, 140, 166, 198, 142, 45, 59, 102, 225, 79, 252, 141, 208, 143, 212, 15, 62, 232, 104, 128, 180, 206, 154, 231, 241, 20, 148, 201, 122, 190, 253, 134, 53, 191, 110, 248, 41, 206, 128, 54, 181, 205, 237, 111, 236, 221, 220, 171, 2, 105, 180, 89, 148, 152, 219, 251, 136, 218, 146, 162, 153, 86, 238
    };
    const vint16m1_t *in2 = &data2[0];
    vint16m1_t out_data[64];
    vint16m1_t *out = &out_data[0];
    for (int n = 64, Q_element = 4;n >= 0; n -= Q_element) {
        vint16m1_t out = __riscv_vadd_vv_i16m1 (data1, data2, 64);
)        in1 += Q_element;
        in2 += Q_element;
        out += Q_element;
      }
    vint16m1_t golden[] = {
    226, 157, 157, 314, 233, 238, 155, 154, 349, 446, 306, 495, 229, 271, 279, 319, 117, 283, 428, 262, 275, 355, 266, 334, 265, 362, 134, 218, 287, 236, 211, 474, 156, 216, 387, 312, 252, 142, 255, 183, 58, 344, 354, 327, 192, 415, 347, 392, 176, 68, 144, 388, 339, 173, 219, 320, 501, 336, 355, 182, 286, 184, 238, 416
    };
    int fail = 0;
    for (int i = 0; i < 64; i++)
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
