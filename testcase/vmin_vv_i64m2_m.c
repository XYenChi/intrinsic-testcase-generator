/* { dg-do run } */
/* { dg-options "-march=rv64gcv -mabi=lp64d -O3 -fno-schedule-insns -fno-schedule-insns2" } */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "riscv_vector.h"
int main(){
    const int64_t data1[] = {
    5699568311505217492, 6913962260428346876, 7285688617407420430, 17352679480424592214, 6279809881732875114, 18135700072969603954, 12356872286801651972, 11835386401755067926, 6224957645334815132, 7986340302642783497, 316664039484597570, 5125507798131763111, 16371386570886315746, 5679094568616547648, 15779792013225601409, 6127562039339220916
    };
    const int64_t *in1 = &data1[0];
    const int64_t data2[] = {
    17821334434297950322, 7101495405528392129, 11328460583864706829, 6967051157469096294, 5174943297526273800, 3669295789641429087, 13998087303816407589, 13299240220774710428, 14439271628490813603, 10114419473395819136, 10685233939433887384, 1224377979109349740, 3496822566104254247, 15544658456187088604, 13311837437593282194, 13449745531148097685
    };
    const int64_t *in2 = &data2[0];
    size_t avl = 64;
    size_t vl = vsetvl_e64m2(size_t avl);
    const int out_data[] = {
    6370673726267100653, 8089311700210615389, 3401606030794941453, 17025853280129907168, 179013600635990235, 5304519718267003372, 18008037542713107516, 13574327061720992707, 597012815265195548, 4442904109471696750, 16895648482446694174, 694956288348914169, 11368147318644406350, 6003225727950268890, 3326246467625581533, 11387832422002918515
    };
    const int64_t *out = &out_data[0];
    bool32_t masked[] = {
    0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1
    };
    const bool32_t *mask = &masked[0];
    vint64m2_t data1_v = __riscv_vle64_v_i64m2_m (mask, *in1, vl);
    vint64m2_t data2_v = __riscv_vle64_v_i64m2_m (mask, *in2, vl);
    for (size_t n = 0; n < vl; n++) {
        out_v = __riscv_vmin_vv_i64m2_m (mask, data1_v, data2_v, vl);
        void vint32_t __riscv_vse64m2_v_i64 (vbool64_t mask, int64m2_t *out, out_v, size_t vl);
        in1 += 8;
        in2 += 8;
        out += 8;
        mask += 8;
      }
    int64_t golden[] = {
    6370673726267100653, 7101495405528392129, 3401606030794941453, 17352679480424592214, 6279809881732875114, 18135700072969603954, 13998087303816407589, 13299240220774710428, 14439271628490813603, 4442904109471696750, 16895648482446694174, 694956288348914169, 11368147318644406350, 6003225727950268890, 15779792013225601409, 13449745531148097685
    };
    int fail = 0;
    for (int i = 0; i < 16; i++){
        if (golden[i] != out_data[i]) {
            printf ("idx=%d golden=%d out=%d\n", i, golden[i], out[i]);
            fail++;
            }
        }
    if (fail) {
        return 1;
    } else {
        return 0;
    }
}
